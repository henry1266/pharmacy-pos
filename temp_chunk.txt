// @access  Public
export const createSale = async (req: Request, res: Response) => {
  const errors = validationResult(req);
  if (!errors.isEmpty()) {
    const errorResponse: ErrorResponse = {
      success: false,
      message: ERROR_MESSAGES.GENERIC.VALIDATION_FAILED,
      error: JSON.stringify(errors.array()),
      timestamp: new Date()
    };
    res.status(400).json(errorResponse);
    return;
  }
  
  try {
    // ?•ç??·å”®?µå»º?„å??´æ?ç¨?
    const sale = await salesService.processSaleCreation(req.body);
    
    // ä½¿ç”¨?‹åˆ¥?·è?è§?±º?‹åˆ¥ä¸åŒ¹?å?é¡?
    const response: ApiResponse<any> = {
      success: true,
      message: SUCCESS_MESSAGES.GENERIC.CREATED,
      data: {
        ...sale.toObject(),
        _id: (sale._id as any).toString(),
        createdAt: sale.createdAt,
        updatedAt: sale.updatedAt
      },
      timestamp: new Date()
    };
    
    res.json(response);
  } catch (err: unknown) {
    logger.error(`?µå»º?·å”®è¨˜é??¯èª¤: ${err instanceof Error ? err.message : 'Unknown error'}`);
    const errorResponse: ErrorResponse = {
      success: false,
      message: ERROR_MESSAGES.GENERIC.SERVER_ERROR,
      timestamp: new Date()
    };
    res.status(500).json(errorResponse);
  }
};

// @route   PUT api/sales/:id
// @desc    Update a sale
// @access  Public
export const updateSale = async (req: Request, res: Response) => {
  try {
    // é©—è? ID ?ƒæ•¸å­˜åœ¨??
    if (!req.params.id) {
      const errorResponse: ErrorResponse = {
        success: false,
        message: ERROR_MESSAGES.GENERIC.NOT_FOUND,
        timestamp: new Date()
      };
      res.status(404).json(errorResponse);
      return;
    }

    // é©—è? ID ?¼å?ï¼Œé˜²æ­?NoSQL æ³¨å…¥
    if (!isValidObjectId(req.params.id)) {
      const errorResponse: ErrorResponse = {
        success: false,
        message: ERROR_MESSAGES.GENERIC.NOT_FOUND,
