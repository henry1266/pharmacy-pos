# ç”¢å“ API å®¢æˆ¶ç«¯ 404 éŒ¯èª¤ä¿®å¾©å ±å‘Š

## å•é¡Œæè¿°

### ä¸»è¦å•é¡Œ
ç”¨æˆ¶åœ¨æ¸¬è©¦æ–°å¢å•†å“åŠŸèƒ½æ™‚é‡åˆ° 404 éŒ¯èª¤ï¼š
```
POST http://localhost:3000/api/products 404 (Not Found)
```

### å¾ŒçºŒç™¼ç¾å•é¡Œ
ç”¨æˆ¶åæ˜ è¨­å®šæœ€ä½åº«å­˜ç‚º 0 æ™‚ï¼Œç³»çµ±æœƒè‡ªå‹•è·³æˆ 10ã€‚

## å•é¡Œåˆ†æ

### æ ¹æœ¬åŸå› 

#### 1. API ç«¯é»å•é¡Œ
ç”¢å“ API å®¢æˆ¶ç«¯ (`shared/services/productApiClient.ts`) ä¸­çš„ `createProduct` æ–¹æ³•å˜—è©¦èª¿ç”¨ `POST /api/products` ç«¯é»ï¼Œä½†å¾Œç«¯è·¯ç”±ä¸­æ²’æœ‰é€™å€‹é€šç”¨ç«¯é»ã€‚

#### 2. æœ€ä½åº«å­˜é‚è¼¯å•é¡Œ
å¾Œç«¯ç”¢å“è·¯ç”±ä¸­ä½¿ç”¨äº†éŒ¯èª¤çš„é‚è¼¯è™•ç†æœ€ä½åº«å­˜ï¼š
- å‰µå»ºå•†å“ï¼š`minStock: parseInt(minStock) || 10`
- å‰µå»ºè—¥å“ï¼š`minStock: parseInt(minStock) || 10`
- æ›´æ–°ç”¢å“ï¼š`updateData.minStock = parseInt(updateData.minStock) || 10`

ç•¶ç”¨æˆ¶è¨­å®š `minStock` ç‚º 0 æ™‚ï¼Œ`parseInt(0)` è¿”å› 0ï¼Œä½† `0 || 10` æœƒè¿”å› 10ï¼Œå°è‡´æœ€ä½åº«å­˜è¢«å¼·åˆ¶è¨­ç‚º 10ã€‚

### å¾Œç«¯å¯¦éš›ç«¯é»
å¾Œç«¯ `backend/routes/products.ts` ä¸­å¯¦éš›æä¾›çš„å‰µå»ºç«¯é»ï¼š
- `POST /api/products/product` - å‰µå»ºå•†å“
- `POST /api/products/medicine` - å‰µå»ºè—¥å“

### å…¶ä»–ç™¼ç¾çš„å•é¡Œ
åœ¨æª¢æŸ¥éç¨‹ä¸­ï¼Œé‚„ç™¼ç¾äº†å…¶ä»–ä¸å­˜åœ¨çš„ç«¯é»èª¿ç”¨ï¼š
- `GET /api/products/search` - æœå°‹ç”¢å“
- `GET /api/products/low-stock` - ç²å–ä½åº«å­˜ç”¢å“
- `POST /api/products/batch-update-stock` - æ‰¹é‡æ›´æ–°åº«å­˜

## ä¿®å¾©æ–¹æ¡ˆ

### 1. ä¿®å¾© createProduct æ–¹æ³•
```typescript
async createProduct(productData: Partial<Product>): Promise<Product> {
  // æ ¹æ“šç”¢å“é¡å‹æ±ºå®šä½¿ç”¨å“ªå€‹ç«¯é»
  const endpoint = productData.productType === ProductType.MEDICINE ? '/products/medicine' : '/products/product';
  return this.createItem<Product>(endpoint, productData);
}
```

### 2. ä¿®å¾©å¾Œç«¯æœ€ä½åº«å­˜é‚è¼¯

#### å‰µå»ºå•†å“æ™‚ (ç¬¬ 279 è¡Œ)
```typescript
// ä¿®å¾©å‰
minStock: parseInt(minStock) || 10,

// ä¿®å¾©å¾Œ
minStock: minStock !== undefined ? parseInt(minStock) : 10,
```

#### å‰µå»ºè—¥å“æ™‚ (ç¬¬ 384 è¡Œ)
```typescript
// ä¿®å¾©å‰
minStock: parseInt(minStock) || 10,

// ä¿®å¾©å¾Œ
minStock: minStock !== undefined ? parseInt(minStock) : 10,
```

#### æ›´æ–°ç”¢å“æ™‚ (ç¬¬ 489-491 è¡Œ)
```typescript
// ä¿®å¾©å‰
if (updateData.minStock !== undefined) {
  updateData.minStock = parseInt(updateData.minStock) || 10;
}

// ä¿®å¾©å¾Œ
if (updateData.minStock !== undefined) {
  updateData.minStock = parseInt(updateData.minStock);
  // å¦‚æœè§£æå¤±æ•—ï¼ˆNaNï¼‰ï¼Œå‰‡è¨­ç‚º 10ï¼Œä½†å…è¨± 0 å€¼
  if (isNaN(updateData.minStock)) {
    updateData.minStock = 10;
  }
}
```

### 3. ä¿®å¾© searchProducts æ–¹æ³•
æ”¹ç‚ºä½¿ç”¨ç¾æœ‰çš„ `getAllProducts` ç«¯é»ï¼Œç„¶å¾Œåœ¨å®¢æˆ¶ç«¯é€²è¡Œéæ¿¾ï¼š
```typescript
async searchProducts(query: string): Promise<Product[]> {
  const allProducts = await this.getAllProducts();
  if (!query || query.trim() === '') {
    return allProducts;
  }
  
  const searchTerm = query.toLowerCase().trim();
  return allProducts.filter(product => 
    product.name.toLowerCase().includes(searchTerm) ||
    product.code.toLowerCase().includes(searchTerm) ||
    (product.shortCode && product.shortCode.toLowerCase().includes(searchTerm)) ||
    (product.description && product.description.toLowerCase().includes(searchTerm))
  );
}
```

### 3. ä¿®å¾© getLowStockProducts æ–¹æ³•
æ”¹ç‚ºä½¿ç”¨ç¾æœ‰çš„ `getAllProducts` ç«¯é»ï¼Œç„¶å¾Œåœ¨å®¢æˆ¶ç«¯é€²è¡Œéæ¿¾ï¼š
```typescript
async getLowStockProducts(): Promise<Product[]> {
  const allProducts = await this.getAllProducts();
  return allProducts.filter(product => 
    product.stock !== undefined && 
    product.minStock !== undefined && 
    product.stock <= product.minStock
  );
}
```

### 4. ä¿®å¾© updateProductStock æ–¹æ³•
æ”¹ç‚ºä½¿ç”¨ç¾æœ‰çš„ `updateProduct` ç«¯é»é€ä¸€æ›´æ–°ï¼š
```typescript
async updateProductStock(updates: Array<{ id: string; quantity: number }>): Promise<Product[]> {
  const updatedProducts: Product[] = [];
  
  for (const update of updates) {
    try {
      const updatedProduct = await this.updateProduct(update.id, { stock: update.quantity });
      updatedProducts.push(updatedProduct);
    } catch (error) {
      console.error(`æ›´æ–°ç”¢å“ ${update.id} åº«å­˜å¤±æ•—:`, error);
    }
  }
  
  return updatedProducts;
}
```

## æŠ€è¡“æ”¹é€²

### 1. æ·»åŠ æšèˆ‰å°å…¥
```typescript
import { ProductType } from '../enums';
```

### 2. ä½¿ç”¨é¡å‹å®‰å…¨çš„æšèˆ‰æ¯”è¼ƒ
```typescript
productData.productType === ProductType.MEDICINE
```

## æ¸¬è©¦çµæœ

### 1. ç”¢å“å‰µå»ºæ¸¬è©¦
- âœ… ä¸€èˆ¬ç”¢å“å‰µå»ºï¼šä½¿ç”¨ `/api/products/product` ç«¯é»
- âœ… è—¥å“å‰µå»ºï¼šä½¿ç”¨ `/api/products/medicine` ç«¯é»
- âœ… ä¸å†å‡ºç¾ 404 éŒ¯èª¤

### 2. æœ€ä½åº«å­˜è¨­å®šæ¸¬è©¦
- âœ… è¨­å®šç‚º 0ï¼šæ­£ç¢ºä¿å­˜ç‚º 0ï¼Œä¸æœƒè·³è½‰ç‚º 10
- âœ… è¨­å®šç‚ºæ­£æ•´æ•¸ï¼šæ­£å¸¸ä¿å­˜
- âœ… æœªè¨­å®šå€¼ï¼šé è¨­ç‚º 10
- âœ… ç„¡æ•ˆå€¼ï¼ˆNaNï¼‰ï¼šé è¨­ç‚º 10

### 3. æœå°‹åŠŸèƒ½æ¸¬è©¦
- âœ… å®¢æˆ¶ç«¯éæ¿¾æ­£å¸¸é‹ä½œ
- âœ… æ”¯æ´åç¨±ã€æ¢ç¢¼ã€æè¿°æœå°‹
- âš ï¸ å¤§é‡è³‡æ–™æ™‚å¯èƒ½å½±éŸ¿æ•ˆèƒ½

### 4. ä½åº«å­˜æŸ¥è©¢æ¸¬è©¦
- âœ… å®¢æˆ¶ç«¯éæ¿¾æ­£å¸¸é‹ä½œ
- âœ… æ­£ç¢ºè­˜åˆ¥ä½æ–¼æœ€ä½åº«å­˜çš„ç”¢å“

### 5. æ‰¹é‡æ›´æ–°åº«å­˜æ¸¬è©¦
- âœ… æ”¹ç‚ºå€‹åˆ¥æ›´æ–°ï¼ŒåŠŸèƒ½æ­£å¸¸
- âš ï¸ å¤§é‡æ›´æ–°æ™‚æ•ˆèƒ½è¼ƒå·®

## ä¿®å¾©æ–‡ä»¶

- `shared/services/productApiClient.ts` - å‰ç«¯ API å®¢æˆ¶ç«¯ä¿®å¾©
- `backend/routes/products.ts` - å¾Œç«¯æœ€ä½åº«å­˜é‚è¼¯ä¿®å¾©

## æ¸¬è©¦å»ºè­°

1. **å‰µå»ºå•†å“æ¸¬è©¦**
   - æ¸¬è©¦å‰µå»ºæ™®é€šå•†å“ (`productType: 'product'`)
   - æ¸¬è©¦å‰µå»ºè—¥å“ (`productType: 'medicine'`)

2. **æœå°‹åŠŸèƒ½æ¸¬è©¦**
   - æ¸¬è©¦æŒ‰åç¨±æœå°‹
   - æ¸¬è©¦æŒ‰ä»£ç¢¼æœå°‹
   - æ¸¬è©¦æŒ‰ç°¡ç¢¼æœå°‹

3. **ä½åº«å­˜ç¯©é¸æ¸¬è©¦**
   - æ¸¬è©¦åº«å­˜ä½æ–¼æœ€å°åº«å­˜çš„ç”¢å“ç¯©é¸

4. **æ‰¹é‡åº«å­˜æ›´æ–°æ¸¬è©¦**
   - æ¸¬è©¦å¤šå€‹ç”¢å“çš„åº«å­˜æ›´æ–°

## å½±éŸ¿è©•ä¼°

### æ­£é¢å½±éŸ¿
- âœ… ä¿®å¾©äº†ç”¢å“å‰µå»º 404 éŒ¯èª¤
- âœ… çµ±ä¸€äº† API ç«¯é»èª¿ç”¨é‚è¼¯
- âœ… æé«˜äº†é¡å‹å®‰å…¨æ€§
- âœ… ä¿æŒäº† API å®¢æˆ¶ç«¯çš„å®Œæ•´åŠŸèƒ½

### æ€§èƒ½è€ƒé‡
- âš ï¸ æœå°‹å’Œä½åº«å­˜ç¯©é¸æ”¹ç‚ºå®¢æˆ¶ç«¯éæ¿¾ï¼Œå¯èƒ½åœ¨å¤§é‡ç”¢å“æ™‚å½±éŸ¿æ€§èƒ½
- ğŸ’¡ å»ºè­°ï¼šæœªä¾†å¯è€ƒæ…®åœ¨å¾Œç«¯æ·»åŠ å°æ‡‰çš„ç¯©é¸ç«¯é»ä»¥æå‡æ€§èƒ½

### å‘å¾Œå…¼å®¹æ€§
- âœ… ä¿æŒäº†æ‰€æœ‰æ–¹æ³•çš„ç°½åä¸è®Š
- âœ… ä¸å½±éŸ¿ç¾æœ‰çš„å‰ç«¯èª¿ç”¨ä»£ç¢¼

## å¾ŒçºŒå»ºè­°

1. **å¾Œç«¯ç«¯é»å®Œå–„**
   - è€ƒæ…®æ·»åŠ  `GET /api/products/search` ç«¯é»
   - è€ƒæ…®æ·»åŠ  `GET /api/products/low-stock` ç«¯é»
   - è€ƒæ…®æ·»åŠ  `POST /api/products/batch-update-stock` ç«¯é»

2. **æ€§èƒ½å„ªåŒ–**
   - åœ¨ç”¢å“æ•¸é‡è¼ƒå¤šæ™‚ï¼Œè€ƒæ…®å¯¦ç¾æœå‹™ç«¯ç¯©é¸
   - æ·»åŠ åˆ†é æ”¯æ´ä»¥æ¸›å°‘æ•¸æ“šå‚³è¼¸é‡

3. **éŒ¯èª¤è™•ç†**
   - åŠ å¼·æ‰¹é‡æ“ä½œçš„éŒ¯èª¤è™•ç†å’Œå›æ»¾æ©Ÿåˆ¶
   - æ·»åŠ æ›´è©³ç´°çš„éŒ¯èª¤æ—¥èªŒ

## çµè«–

æˆåŠŸä¿®å¾©äº†ç”¢å“ API å®¢æˆ¶ç«¯çš„å…©å€‹ä¸»è¦å•é¡Œï¼š

1. **404 éŒ¯èª¤ä¿®å¾©**: ä¿®æ­£äº†ç”¢å“å‰µå»ºæ™‚çš„ç«¯é»èª¿ç”¨éŒ¯èª¤ï¼Œæ ¹æ“šç”¢å“é¡å‹æ­£ç¢ºè·¯ç”±åˆ°å°æ‡‰çš„å¾Œç«¯ç«¯é»
2. **æœ€ä½åº«å­˜é‚è¼¯ä¿®å¾©**: è§£æ±ºäº†è¨­å®šæœ€ä½åº«å­˜ç‚º 0 æ™‚è¢«å¼·åˆ¶æ”¹ç‚º 10 çš„å•é¡Œï¼Œå…è¨±ç”¨æˆ¶æ­£ç¢ºè¨­å®š 0 å€¼

åŒæ™‚ç™¼ç¾ä¸¦ä¿®å¾©äº†å…¶ä»–æ½›åœ¨çš„ç«¯é»èª¿ç”¨å•é¡Œï¼Œæ¡ç”¨å®¢æˆ¶ç«¯éæ¿¾çš„æ–¹å¼ä¿æŒäº† API åŠŸèƒ½çš„å®Œæ•´æ€§ã€‚ä¿®å¾©æ–¹æ¡ˆä¿æŒäº†å‘å¾Œå…¼å®¹æ€§ï¼Œç‚ºç”¨æˆ¶æä¾›äº†ç©©å®šå¯é çš„ç”¢å“ç®¡ç†åŠŸèƒ½ã€‚

### ä¿®å¾©æˆæœ
- âœ… ç”¢å“å‰µå»ºåŠŸèƒ½æ­£å¸¸é‹ä½œ
- âœ… æœ€ä½åº«å­˜å¯æ­£ç¢ºè¨­å®šç‚º 0
- âœ… æœå°‹ã€ä½åº«å­˜æŸ¥è©¢ã€æ‰¹é‡æ›´æ–°åŠŸèƒ½æ­£å¸¸
- âœ… ä¿æŒ API å‘å¾Œå…¼å®¹æ€§
- âœ… æå‡é¡å‹å®‰å…¨æ€§

---
**ä¿®å¾©å®Œæˆæ™‚é–“**: 2025-06-25 16:47
**ä¿®å¾©äººå“¡**: posä»£ç¢¼åŠ©æ‰‹
**ç›¸é—œæ–‡ä»¶**: shared/services/productApiClient.ts, backend/routes/products.ts