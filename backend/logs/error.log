{"error":"Database error","level":"\u001b[31merror\u001b[39m","message":"\u001b[31m建立交易錯誤\u001b[39m","timestamp":"2025-08-10 14:45:27:4527"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31m創建銷售記錄錯誤: Database connection failed\u001b[39m","timestamp":"2025-08-11 22:51:50:5150"}
{"error":"Database error","level":"\u001b[31merror\u001b[39m","message":"\u001b[31m建立交易錯誤\u001b[39m","timestamp":"2025-08-11 22:52:21:5221"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'建立交易群組錯誤: 交易群組編號 TXN001 已存在'\u001b[39m","stack":"Error: 交易群組編號 TXN001 已存在\n    at Function.createTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:35:17)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:102:7)","timestamp":"2025-08-11 22:52:31:5231"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'取得交易群組詳細資料錯誤: 交易群組不存在或無權限存取'\u001b[39m","stack":"Error: 交易群組不存在或無權限存取\n    at Function.getTransactionGroupById (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:162:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:235:7)","timestamp":"2025-08-11 22:52:31:5231"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'更新交易群組錯誤: 交易群組不存在或無權限存取'\u001b[39m","stack":"Error: 交易群組不存在或無權限存取\n    at Function.updateTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:221:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:333:7)","timestamp":"2025-08-11 22:52:31:5231"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'更新交易群組錯誤: 已確認的交易無法修改'\u001b[39m","stack":"Error: 已確認的交易無法修改\n    at Function.updateTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:226:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:344:7)","timestamp":"2025-08-11 22:52:31:5231"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'更新交易群組錯誤: 交易群組編號 NEW001 已存在'\u001b[39m","stack":"Error: 交易群組編號 NEW001 已存在\n    at Function.updateTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:238:17)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:358:7)","timestamp":"2025-08-11 22:52:31:5231"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 交易群組不存在或無權限存取'\u001b[39m","stack":"Error: 交易群組不存在或無權限存取\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:286:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:402:7)","timestamp":"2025-08-11 22:52:31:5231"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 交易群組已經確認'\u001b[39m","stack":"Error: 交易群組已經確認\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:290:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:413:7)","timestamp":"2025-08-11 22:52:31:5231"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 已取消的交易無法確認'\u001b[39m","stack":"Error: 已取消的交易無法確認\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:294:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:424:7)","timestamp":"2025-08-11 22:52:31:5231"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 交易群組必須包含分錄才能確認'\u001b[39m","stack":"Error: 交易群組必須包含分錄才能確認\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:299:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:439:7)","timestamp":"2025-08-11 22:52:31:5231"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 交易借貸不平衡：借方 1000，貸方 500'\u001b[39m","stack":"Error: 交易借貸不平衡：借方 1000，貸方 500\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:307:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:457:7)","timestamp":"2025-08-11 22:52:31:5231"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'取消交易群組錯誤: 交易群組不存在或無權限存取'\u001b[39m","stack":"Error: 交易群組不存在或無權限存取\n    at Function.cancelTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:352:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:495:7)","timestamp":"2025-08-11 22:52:31:5231"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'取消交易群組錯誤: 交易群組已經取消'\u001b[39m","stack":"Error: 交易群組已經取消\n    at Function.cancelTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:356:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:506:7)","timestamp":"2025-08-11 22:52:31:5231"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'取消交易群組錯誤: 無法取消交易：有 2 筆交易引用此交易'\u001b[39m","stack":"Error: 無法取消交易：有 2 筆交易引用此交易\n    at Function.cancelTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:367:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:520:7)","timestamp":"2025-08-11 22:52:31:5231"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'計算交易餘額錯誤: 交易不存在、未確認或無權限存取'\u001b[39m","stack":"Error: 交易不存在、未確認或無權限存取\n    at Function.calculateTransactionBalance (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:501:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:570:7)","timestamp":"2025-08-11 22:52:31:5231"}
{"existingAccountIds":[],"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'缺少的科目 ID:'\u001b[39m","missingAccountIds":["nonexistent"],"queryConditions":{"uniqueAccountIds":["nonexistent"],"userId":"user123"},"timestamp":"2025-08-11 22:52:31:5231"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'創建自動會計分錄時發生錯誤: 部分會計科目不存在'\u001b[39m","stack":"Error: 部分會計科目不存在\n    at Function.getAccountDetails (D:\\pharmacy-pos\\backend\\services\\AutoAccountingEntryService.ts:210:13)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Function.handlePurchaseOrderCompletion (D:\\pharmacy-pos\\backend\\services\\AutoAccountingEntryService.ts:30:24)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\__tests__\\AutoAccountingEntryService.test.ts:241:7)","timestamp":"2025-08-11 22:52:50:5250"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'建立交易群組錯誤: 交易群組編號 TXN001 已存在'\u001b[39m","stack":"Error: 交易群組編號 TXN001 已存在\n    at Function.createTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:35:17)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:102:7)","timestamp":"2025-08-11 23:05:32:532"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'取得交易群組詳細資料錯誤: 交易群組不存在或無權限存取'\u001b[39m","stack":"Error: 交易群組不存在或無權限存取\n    at Function.getTransactionGroupById (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:162:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:235:7)","timestamp":"2025-08-11 23:05:32:532"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'更新交易群組錯誤: 交易群組不存在或無權限存取'\u001b[39m","stack":"Error: 交易群組不存在或無權限存取\n    at Function.updateTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:221:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:333:7)","timestamp":"2025-08-11 23:05:32:532"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'更新交易群組錯誤: 已確認的交易無法修改'\u001b[39m","stack":"Error: 已確認的交易無法修改\n    at Function.updateTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:226:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:344:7)","timestamp":"2025-08-11 23:05:32:532"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'更新交易群組錯誤: 交易群組編號 NEW001 已存在'\u001b[39m","stack":"Error: 交易群組編號 NEW001 已存在\n    at Function.updateTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:238:17)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:358:7)","timestamp":"2025-08-11 23:05:32:532"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 交易群組不存在或無權限存取'\u001b[39m","stack":"Error: 交易群組不存在或無權限存取\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:286:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:402:7)","timestamp":"2025-08-11 23:05:32:532"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 交易群組已經確認'\u001b[39m","stack":"Error: 交易群組已經確認\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:290:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:413:7)","timestamp":"2025-08-11 23:05:32:532"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 已取消的交易無法確認'\u001b[39m","stack":"Error: 已取消的交易無法確認\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:294:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:424:7)","timestamp":"2025-08-11 23:05:32:532"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 交易群組必須包含分錄才能確認'\u001b[39m","stack":"Error: 交易群組必須包含分錄才能確認\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:299:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:439:7)","timestamp":"2025-08-11 23:05:32:532"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 交易借貸不平衡：借方 1000，貸方 500'\u001b[39m","stack":"Error: 交易借貸不平衡：借方 1000，貸方 500\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:307:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:457:7)","timestamp":"2025-08-11 23:05:32:532"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'取消交易群組錯誤: 交易群組不存在或無權限存取'\u001b[39m","stack":"Error: 交易群組不存在或無權限存取\n    at Function.cancelTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:352:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:495:7)","timestamp":"2025-08-11 23:05:32:532"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'取消交易群組錯誤: 交易群組已經取消'\u001b[39m","stack":"Error: 交易群組已經取消\n    at Function.cancelTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:356:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:506:7)","timestamp":"2025-08-11 23:05:32:532"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'取消交易群組錯誤: 無法取消交易：有 2 筆交易引用此交易'\u001b[39m","stack":"Error: 無法取消交易：有 2 筆交易引用此交易\n    at Function.cancelTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:367:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:520:7)","timestamp":"2025-08-11 23:05:32:532"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'計算交易餘額錯誤: 交易不存在、未確認或無權限存取'\u001b[39m","stack":"Error: 交易不存在、未確認或無權限存取\n    at Function.calculateTransactionBalance (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:501:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:570:7)","timestamp":"2025-08-11 23:05:32:532"}
{"existingAccountIds":[],"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'缺少的科目 ID:'\u001b[39m","missingAccountIds":["nonexistent"],"queryConditions":{"uniqueAccountIds":["nonexistent"],"userId":"user123"},"timestamp":"2025-08-11 23:05:32:532"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31m創建銷售記錄錯誤: Database connection failed\u001b[39m","timestamp":"2025-08-11 23:05:44:544"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'創建自動會計分錄時發生錯誤: 部分會計科目不存在'\u001b[39m","stack":"Error: 部分會計科目不存在\n    at Function.getAccountDetails (D:\\pharmacy-pos\\backend\\services\\AutoAccountingEntryService.ts:210:13)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Function.handlePurchaseOrderCompletion (D:\\pharmacy-pos\\backend\\services\\AutoAccountingEntryService.ts:30:24)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\__tests__\\AutoAccountingEntryService.test.ts:241:7)","timestamp":"2025-08-11 23:06:26:626"}
{"error":"Database error","level":"\u001b[31merror\u001b[39m","message":"\u001b[31m建立交易錯誤\u001b[39m","timestamp":"2025-08-11 23:06:32:632"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'建立交易群組錯誤: 交易群組編號 TXN001 已存在'\u001b[39m","stack":"Error: 交易群組編號 TXN001 已存在\n    at Function.createTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:35:17)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:102:7)","timestamp":"2025-08-11 23:13:02:132"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'取得交易群組詳細資料錯誤: 交易群組不存在或無權限存取'\u001b[39m","stack":"Error: 交易群組不存在或無權限存取\n    at Function.getTransactionGroupById (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:162:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:235:7)","timestamp":"2025-08-11 23:13:02:132"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'更新交易群組錯誤: 交易群組不存在或無權限存取'\u001b[39m","stack":"Error: 交易群組不存在或無權限存取\n    at Function.updateTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:221:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:333:7)","timestamp":"2025-08-11 23:13:02:132"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'更新交易群組錯誤: 已確認的交易無法修改'\u001b[39m","stack":"Error: 已確認的交易無法修改\n    at Function.updateTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:226:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:344:7)","timestamp":"2025-08-11 23:13:02:132"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'更新交易群組錯誤: 交易群組編號 NEW001 已存在'\u001b[39m","stack":"Error: 交易群組編號 NEW001 已存在\n    at Function.updateTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:238:17)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:358:7)","timestamp":"2025-08-11 23:13:03:133"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 交易群組不存在或無權限存取'\u001b[39m","stack":"Error: 交易群組不存在或無權限存取\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:286:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:402:7)","timestamp":"2025-08-11 23:13:03:133"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 交易群組已經確認'\u001b[39m","stack":"Error: 交易群組已經確認\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:290:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:413:7)","timestamp":"2025-08-11 23:13:03:133"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 已取消的交易無法確認'\u001b[39m","stack":"Error: 已取消的交易無法確認\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:294:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:424:7)","timestamp":"2025-08-11 23:13:03:133"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 交易群組必須包含分錄才能確認'\u001b[39m","stack":"Error: 交易群組必須包含分錄才能確認\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:299:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:439:7)","timestamp":"2025-08-11 23:13:03:133"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 交易借貸不平衡：借方 1000，貸方 500'\u001b[39m","stack":"Error: 交易借貸不平衡：借方 1000，貸方 500\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:307:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:457:7)","timestamp":"2025-08-11 23:13:03:133"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'取消交易群組錯誤: 交易群組不存在或無權限存取'\u001b[39m","stack":"Error: 交易群組不存在或無權限存取\n    at Function.cancelTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:352:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:495:7)","timestamp":"2025-08-11 23:13:03:133"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'取消交易群組錯誤: 交易群組已經取消'\u001b[39m","stack":"Error: 交易群組已經取消\n    at Function.cancelTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:356:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:506:7)","timestamp":"2025-08-11 23:13:03:133"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'取消交易群組錯誤: 無法取消交易：有 2 筆交易引用此交易'\u001b[39m","stack":"Error: 無法取消交易：有 2 筆交易引用此交易\n    at Function.cancelTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:367:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:520:7)","timestamp":"2025-08-11 23:13:03:133"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'計算交易餘額錯誤: 交易不存在、未確認或無權限存取'\u001b[39m","stack":"Error: 交易不存在、未確認或無權限存取\n    at Function.calculateTransactionBalance (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:501:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:570:7)","timestamp":"2025-08-11 23:13:03:133"}
{"existingAccountIds":[],"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'缺少的科目 ID:'\u001b[39m","missingAccountIds":["nonexistent"],"queryConditions":{"uniqueAccountIds":["nonexistent"],"userId":"user123"},"timestamp":"2025-08-11 23:13:03:133"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31m創建銷售記錄錯誤: Database connection failed\u001b[39m","timestamp":"2025-08-11 23:13:18:1318"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'創建自動會計分錄時發生錯誤: 部分會計科目不存在'\u001b[39m","stack":"Error: 部分會計科目不存在\n    at Function.getAccountDetails (D:\\pharmacy-pos\\backend\\services\\AutoAccountingEntryService.ts:210:13)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Function.handlePurchaseOrderCompletion (D:\\pharmacy-pos\\backend\\services\\AutoAccountingEntryService.ts:30:24)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\__tests__\\AutoAccountingEntryService.test.ts:241:7)","timestamp":"2025-08-11 23:13:57:1357"}
{"error":"Database error","level":"\u001b[31merror\u001b[39m","message":"\u001b[31m建立交易錯誤\u001b[39m","timestamp":"2025-08-11 23:14:02:142"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'建立交易群組錯誤: 交易群組編號 TXN001 已存在'\u001b[39m","stack":"Error: 交易群組編號 TXN001 已存在\n    at Function.createTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:35:17)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:102:7)","timestamp":"2025-08-11 23:28:00:280"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'取得交易群組詳細資料錯誤: 交易群組不存在或無權限存取'\u001b[39m","stack":"Error: 交易群組不存在或無權限存取\n    at Function.getTransactionGroupById (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:162:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:235:7)","timestamp":"2025-08-11 23:28:00:280"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'更新交易群組錯誤: 交易群組不存在或無權限存取'\u001b[39m","stack":"Error: 交易群組不存在或無權限存取\n    at Function.updateTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:221:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:333:7)","timestamp":"2025-08-11 23:28:00:280"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'更新交易群組錯誤: 已確認的交易無法修改'\u001b[39m","stack":"Error: 已確認的交易無法修改\n    at Function.updateTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:226:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:344:7)","timestamp":"2025-08-11 23:28:00:280"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'更新交易群組錯誤: 交易群組編號 NEW001 已存在'\u001b[39m","stack":"Error: 交易群組編號 NEW001 已存在\n    at Function.updateTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:238:17)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:358:7)","timestamp":"2025-08-11 23:28:00:280"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 交易群組不存在或無權限存取'\u001b[39m","stack":"Error: 交易群組不存在或無權限存取\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:286:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:402:7)","timestamp":"2025-08-11 23:28:00:280"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 交易群組已經確認'\u001b[39m","stack":"Error: 交易群組已經確認\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:290:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:413:7)","timestamp":"2025-08-11 23:28:00:280"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 已取消的交易無法確認'\u001b[39m","stack":"Error: 已取消的交易無法確認\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:294:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:424:7)","timestamp":"2025-08-11 23:28:00:280"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 交易群組必須包含分錄才能確認'\u001b[39m","stack":"Error: 交易群組必須包含分錄才能確認\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:299:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:439:7)","timestamp":"2025-08-11 23:28:00:280"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 交易借貸不平衡：借方 1000，貸方 500'\u001b[39m","stack":"Error: 交易借貸不平衡：借方 1000，貸方 500\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:307:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:457:7)","timestamp":"2025-08-11 23:28:00:280"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'取消交易群組錯誤: 交易群組不存在或無權限存取'\u001b[39m","stack":"Error: 交易群組不存在或無權限存取\n    at Function.cancelTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:352:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:495:7)","timestamp":"2025-08-11 23:28:00:280"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'取消交易群組錯誤: 交易群組已經取消'\u001b[39m","stack":"Error: 交易群組已經取消\n    at Function.cancelTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:356:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:506:7)","timestamp":"2025-08-11 23:28:00:280"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'取消交易群組錯誤: 無法取消交易：有 2 筆交易引用此交易'\u001b[39m","stack":"Error: 無法取消交易：有 2 筆交易引用此交易\n    at Function.cancelTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:367:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:520:7)","timestamp":"2025-08-11 23:28:00:280"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'計算交易餘額錯誤: 交易不存在、未確認或無權限存取'\u001b[39m","stack":"Error: 交易不存在、未確認或無權限存取\n    at Function.calculateTransactionBalance (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:501:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:570:7)","timestamp":"2025-08-11 23:28:00:280"}
{"existingAccountIds":[],"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'缺少的科目 ID:'\u001b[39m","missingAccountIds":["nonexistent"],"queryConditions":{"uniqueAccountIds":["nonexistent"],"userId":"user123"},"timestamp":"2025-08-11 23:28:00:280"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31m創建銷售記錄錯誤: Database connection failed\u001b[39m","timestamp":"2025-08-11 23:28:16:2816"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'創建自動會計分錄時發生錯誤: 部分會計科目不存在'\u001b[39m","stack":"Error: 部分會計科目不存在\n    at Function.getAccountDetails (D:\\pharmacy-pos\\backend\\services\\AutoAccountingEntryService.ts:210:13)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Function.handlePurchaseOrderCompletion (D:\\pharmacy-pos\\backend\\services\\AutoAccountingEntryService.ts:30:24)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\__tests__\\AutoAccountingEntryService.test.ts:241:7)","timestamp":"2025-08-11 23:29:15:2915"}
{"error":"Database error","level":"\u001b[31merror\u001b[39m","message":"\u001b[31m建立交易錯誤\u001b[39m","timestamp":"2025-08-11 23:29:18:2918"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31m創建銷售記錄錯誤: Database connection failed\u001b[39m","timestamp":"2025-08-12 00:15:27:1527"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'建立交易群組錯誤: 交易群組編號 TXN001 已存在'\u001b[39m","stack":"Error: 交易群組編號 TXN001 已存在\n    at Function.createTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:35:17)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:102:7)","timestamp":"2025-08-12 00:15:59:1559"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'取得交易群組詳細資料錯誤: 交易群組不存在或無權限存取'\u001b[39m","stack":"Error: 交易群組不存在或無權限存取\n    at Function.getTransactionGroupById (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:162:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:235:7)","timestamp":"2025-08-12 00:15:59:1559"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'更新交易群組錯誤: 交易群組不存在或無權限存取'\u001b[39m","stack":"Error: 交易群組不存在或無權限存取\n    at Function.updateTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:221:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:333:7)","timestamp":"2025-08-12 00:15:59:1559"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'更新交易群組錯誤: 已確認的交易無法修改'\u001b[39m","stack":"Error: 已確認的交易無法修改\n    at Function.updateTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:226:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:344:7)","timestamp":"2025-08-12 00:15:59:1559"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'更新交易群組錯誤: 交易群組編號 NEW001 已存在'\u001b[39m","stack":"Error: 交易群組編號 NEW001 已存在\n    at Function.updateTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:238:17)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:358:7)","timestamp":"2025-08-12 00:15:59:1559"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 交易群組不存在或無權限存取'\u001b[39m","stack":"Error: 交易群組不存在或無權限存取\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:286:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:402:7)","timestamp":"2025-08-12 00:15:59:1559"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 交易群組已經確認'\u001b[39m","stack":"Error: 交易群組已經確認\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:290:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:413:7)","timestamp":"2025-08-12 00:15:59:1559"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 已取消的交易無法確認'\u001b[39m","stack":"Error: 已取消的交易無法確認\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:294:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:424:7)","timestamp":"2025-08-12 00:15:59:1559"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 交易群組必須包含分錄才能確認'\u001b[39m","stack":"Error: 交易群組必須包含分錄才能確認\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:299:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:439:7)","timestamp":"2025-08-12 00:15:59:1559"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 交易借貸不平衡：借方 1000，貸方 500'\u001b[39m","stack":"Error: 交易借貸不平衡：借方 1000，貸方 500\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:307:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:457:7)","timestamp":"2025-08-12 00:15:59:1559"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'取消交易群組錯誤: 交易群組不存在或無權限存取'\u001b[39m","stack":"Error: 交易群組不存在或無權限存取\n    at Function.cancelTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:352:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:495:7)","timestamp":"2025-08-12 00:15:59:1559"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'取消交易群組錯誤: 交易群組已經取消'\u001b[39m","stack":"Error: 交易群組已經取消\n    at Function.cancelTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:356:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:506:7)","timestamp":"2025-08-12 00:15:59:1559"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'取消交易群組錯誤: 無法取消交易：有 2 筆交易引用此交易'\u001b[39m","stack":"Error: 無法取消交易：有 2 筆交易引用此交易\n    at Function.cancelTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:367:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:520:7)","timestamp":"2025-08-12 00:15:59:1559"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'計算交易餘額錯誤: 交易不存在、未確認或無權限存取'\u001b[39m","stack":"Error: 交易不存在、未確認或無權限存取\n    at Function.calculateTransactionBalance (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:501:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:570:7)","timestamp":"2025-08-12 00:15:59:1559"}
{"existingAccountIds":[],"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'缺少的科目 ID:'\u001b[39m","missingAccountIds":["nonexistent"],"queryConditions":{"uniqueAccountIds":["nonexistent"],"userId":"user123"},"timestamp":"2025-08-12 00:15:59:1559"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'創建自動會計分錄時發生錯誤: 部分會計科目不存在'\u001b[39m","stack":"Error: 部分會計科目不存在\n    at Function.getAccountDetails (D:\\pharmacy-pos\\backend\\services\\AutoAccountingEntryService.ts:210:13)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Function.handlePurchaseOrderCompletion (D:\\pharmacy-pos\\backend\\services\\AutoAccountingEntryService.ts:30:24)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\__tests__\\AutoAccountingEntryService.test.ts:241:7)","timestamp":"2025-08-12 00:16:05:165"}
{"error":"Database error","level":"\u001b[31merror\u001b[39m","message":"\u001b[31m建立交易錯誤\u001b[39m","timestamp":"2025-08-12 00:16:13:1613"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31m創建銷售記錄錯誤: Database connection failed\u001b[39m","timestamp":"2025-08-12 00:21:50:2150"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'建立交易群組錯誤: 交易群組編號 TXN001 已存在'\u001b[39m","stack":"Error: 交易群組編號 TXN001 已存在\n    at Function.createTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:35:17)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:102:7)","timestamp":"2025-08-12 00:22:34:2234"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'取得交易群組詳細資料錯誤: 交易群組不存在或無權限存取'\u001b[39m","stack":"Error: 交易群組不存在或無權限存取\n    at Function.getTransactionGroupById (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:162:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:235:7)","timestamp":"2025-08-12 00:22:34:2234"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'更新交易群組錯誤: 交易群組不存在或無權限存取'\u001b[39m","stack":"Error: 交易群組不存在或無權限存取\n    at Function.updateTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:221:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:333:7)","timestamp":"2025-08-12 00:22:34:2234"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'更新交易群組錯誤: 已確認的交易無法修改'\u001b[39m","stack":"Error: 已確認的交易無法修改\n    at Function.updateTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:226:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:344:7)","timestamp":"2025-08-12 00:22:34:2234"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'更新交易群組錯誤: 交易群組編號 NEW001 已存在'\u001b[39m","stack":"Error: 交易群組編號 NEW001 已存在\n    at Function.updateTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:238:17)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:358:7)","timestamp":"2025-08-12 00:22:34:2234"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 交易群組不存在或無權限存取'\u001b[39m","stack":"Error: 交易群組不存在或無權限存取\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:286:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:402:7)","timestamp":"2025-08-12 00:22:34:2234"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 交易群組已經確認'\u001b[39m","stack":"Error: 交易群組已經確認\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:290:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:413:7)","timestamp":"2025-08-12 00:22:34:2234"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 已取消的交易無法確認'\u001b[39m","stack":"Error: 已取消的交易無法確認\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:294:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:424:7)","timestamp":"2025-08-12 00:22:34:2234"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 交易群組必須包含分錄才能確認'\u001b[39m","stack":"Error: 交易群組必須包含分錄才能確認\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:299:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:439:7)","timestamp":"2025-08-12 00:22:34:2234"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 交易借貸不平衡：借方 1000，貸方 500'\u001b[39m","stack":"Error: 交易借貸不平衡：借方 1000，貸方 500\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:307:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:457:7)","timestamp":"2025-08-12 00:22:34:2234"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'取消交易群組錯誤: 交易群組不存在或無權限存取'\u001b[39m","stack":"Error: 交易群組不存在或無權限存取\n    at Function.cancelTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:352:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:495:7)","timestamp":"2025-08-12 00:22:34:2234"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'取消交易群組錯誤: 交易群組已經取消'\u001b[39m","stack":"Error: 交易群組已經取消\n    at Function.cancelTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:356:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:506:7)","timestamp":"2025-08-12 00:22:34:2234"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'取消交易群組錯誤: 無法取消交易：有 2 筆交易引用此交易'\u001b[39m","stack":"Error: 無法取消交易：有 2 筆交易引用此交易\n    at Function.cancelTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:367:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:520:7)","timestamp":"2025-08-12 00:22:34:2234"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'計算交易餘額錯誤: 交易不存在、未確認或無權限存取'\u001b[39m","stack":"Error: 交易不存在、未確認或無權限存取\n    at Function.calculateTransactionBalance (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:501:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:570:7)","timestamp":"2025-08-12 00:22:34:2234"}
{"existingAccountIds":[],"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'缺少的科目 ID:'\u001b[39m","missingAccountIds":["nonexistent"],"queryConditions":{"uniqueAccountIds":["nonexistent"],"userId":"user123"},"timestamp":"2025-08-12 00:22:34:2234"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'創建自動會計分錄時發生錯誤: 部分會計科目不存在'\u001b[39m","stack":"Error: 部分會計科目不存在\n    at Function.getAccountDetails (D:\\pharmacy-pos\\backend\\services\\AutoAccountingEntryService.ts:210:13)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Function.handlePurchaseOrderCompletion (D:\\pharmacy-pos\\backend\\services\\AutoAccountingEntryService.ts:30:24)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\__tests__\\AutoAccountingEntryService.test.ts:241:7)","timestamp":"2025-08-12 00:22:40:2240"}
{"error":"Database error","level":"\u001b[31merror\u001b[39m","message":"\u001b[31m建立交易錯誤\u001b[39m","timestamp":"2025-08-12 00:22:51:2251"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31m創建銷售記錄錯誤: Database connection failed\u001b[39m","timestamp":"2025-08-12 00:35:58:3558"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'建立交易群組錯誤: 交易群組編號 TXN001 已存在'\u001b[39m","stack":"Error: 交易群組編號 TXN001 已存在\n    at Function.createTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:35:17)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:102:7)","timestamp":"2025-08-12 00:36:46:3646"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'取得交易群組詳細資料錯誤: 交易群組不存在或無權限存取'\u001b[39m","stack":"Error: 交易群組不存在或無權限存取\n    at Function.getTransactionGroupById (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:162:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:235:7)","timestamp":"2025-08-12 00:36:46:3646"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'更新交易群組錯誤: 交易群組不存在或無權限存取'\u001b[39m","stack":"Error: 交易群組不存在或無權限存取\n    at Function.updateTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:221:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:333:7)","timestamp":"2025-08-12 00:36:46:3646"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'更新交易群組錯誤: 已確認的交易無法修改'\u001b[39m","stack":"Error: 已確認的交易無法修改\n    at Function.updateTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:226:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:344:7)","timestamp":"2025-08-12 00:36:46:3646"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'更新交易群組錯誤: 交易群組編號 NEW001 已存在'\u001b[39m","stack":"Error: 交易群組編號 NEW001 已存在\n    at Function.updateTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:238:17)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:358:7)","timestamp":"2025-08-12 00:36:46:3646"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 交易群組不存在或無權限存取'\u001b[39m","stack":"Error: 交易群組不存在或無權限存取\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:286:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:402:7)","timestamp":"2025-08-12 00:36:46:3646"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 交易群組已經確認'\u001b[39m","stack":"Error: 交易群組已經確認\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:290:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:413:7)","timestamp":"2025-08-12 00:36:46:3646"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 已取消的交易無法確認'\u001b[39m","stack":"Error: 已取消的交易無法確認\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:294:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:424:7)","timestamp":"2025-08-12 00:36:46:3646"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 交易群組必須包含分錄才能確認'\u001b[39m","stack":"Error: 交易群組必須包含分錄才能確認\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:299:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:439:7)","timestamp":"2025-08-12 00:36:46:3646"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 交易借貸不平衡：借方 1000，貸方 500'\u001b[39m","stack":"Error: 交易借貸不平衡：借方 1000，貸方 500\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:307:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:457:7)","timestamp":"2025-08-12 00:36:46:3646"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'取消交易群組錯誤: 交易群組不存在或無權限存取'\u001b[39m","stack":"Error: 交易群組不存在或無權限存取\n    at Function.cancelTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:352:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:495:7)","timestamp":"2025-08-12 00:36:46:3646"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'取消交易群組錯誤: 交易群組已經取消'\u001b[39m","stack":"Error: 交易群組已經取消\n    at Function.cancelTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:356:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:506:7)","timestamp":"2025-08-12 00:36:46:3646"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'取消交易群組錯誤: 無法取消交易：有 2 筆交易引用此交易'\u001b[39m","stack":"Error: 無法取消交易：有 2 筆交易引用此交易\n    at Function.cancelTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:367:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:520:7)","timestamp":"2025-08-12 00:36:46:3646"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'計算交易餘額錯誤: 交易不存在、未確認或無權限存取'\u001b[39m","stack":"Error: 交易不存在、未確認或無權限存取\n    at Function.calculateTransactionBalance (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:501:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:570:7)","timestamp":"2025-08-12 00:36:46:3646"}
{"existingAccountIds":[],"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'缺少的科目 ID:'\u001b[39m","missingAccountIds":["nonexistent"],"queryConditions":{"uniqueAccountIds":["nonexistent"],"userId":"user123"},"timestamp":"2025-08-12 00:36:46:3646"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'創建自動會計分錄時發生錯誤: 部分會計科目不存在'\u001b[39m","stack":"Error: 部分會計科目不存在\n    at Function.getAccountDetails (D:\\pharmacy-pos\\backend\\services\\AutoAccountingEntryService.ts:210:13)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Function.handlePurchaseOrderCompletion (D:\\pharmacy-pos\\backend\\services\\AutoAccountingEntryService.ts:30:24)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\__tests__\\AutoAccountingEntryService.test.ts:241:7)","timestamp":"2025-08-12 00:36:48:3648"}
{"error":"Database error","level":"\u001b[31merror\u001b[39m","message":"\u001b[31m建立交易錯誤\u001b[39m","timestamp":"2025-08-12 00:36:57:3657"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31m創建銷售記錄錯誤: Database connection failed\u001b[39m","timestamp":"2025-08-12 00:41:11:4111"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'建立交易群組錯誤: 交易群組編號 TXN001 已存在'\u001b[39m","stack":"Error: 交易群組編號 TXN001 已存在\n    at Function.createTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:35:17)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:102:7)","timestamp":"2025-08-12 00:41:48:4148"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'取得交易群組詳細資料錯誤: 交易群組不存在或無權限存取'\u001b[39m","stack":"Error: 交易群組不存在或無權限存取\n    at Function.getTransactionGroupById (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:162:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:235:7)","timestamp":"2025-08-12 00:41:48:4148"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'更新交易群組錯誤: 交易群組不存在或無權限存取'\u001b[39m","stack":"Error: 交易群組不存在或無權限存取\n    at Function.updateTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:221:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:333:7)","timestamp":"2025-08-12 00:41:48:4148"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'更新交易群組錯誤: 已確認的交易無法修改'\u001b[39m","stack":"Error: 已確認的交易無法修改\n    at Function.updateTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:226:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:344:7)","timestamp":"2025-08-12 00:41:48:4148"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'更新交易群組錯誤: 交易群組編號 NEW001 已存在'\u001b[39m","stack":"Error: 交易群組編號 NEW001 已存在\n    at Function.updateTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:238:17)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:358:7)","timestamp":"2025-08-12 00:41:48:4148"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 交易群組不存在或無權限存取'\u001b[39m","stack":"Error: 交易群組不存在或無權限存取\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:286:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:402:7)","timestamp":"2025-08-12 00:41:48:4148"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 交易群組已經確認'\u001b[39m","stack":"Error: 交易群組已經確認\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:290:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:413:7)","timestamp":"2025-08-12 00:41:48:4148"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 已取消的交易無法確認'\u001b[39m","stack":"Error: 已取消的交易無法確認\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:294:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:424:7)","timestamp":"2025-08-12 00:41:48:4148"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 交易群組必須包含分錄才能確認'\u001b[39m","stack":"Error: 交易群組必須包含分錄才能確認\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:299:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:439:7)","timestamp":"2025-08-12 00:41:48:4148"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 交易借貸不平衡：借方 1000，貸方 500'\u001b[39m","stack":"Error: 交易借貸不平衡：借方 1000，貸方 500\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:307:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:457:7)","timestamp":"2025-08-12 00:41:48:4148"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'取消交易群組錯誤: 交易群組不存在或無權限存取'\u001b[39m","stack":"Error: 交易群組不存在或無權限存取\n    at Function.cancelTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:352:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:495:7)","timestamp":"2025-08-12 00:41:48:4148"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'取消交易群組錯誤: 交易群組已經取消'\u001b[39m","stack":"Error: 交易群組已經取消\n    at Function.cancelTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:356:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:506:7)","timestamp":"2025-08-12 00:41:48:4148"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'取消交易群組錯誤: 無法取消交易：有 2 筆交易引用此交易'\u001b[39m","stack":"Error: 無法取消交易：有 2 筆交易引用此交易\n    at Function.cancelTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:367:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:520:7)","timestamp":"2025-08-12 00:41:48:4148"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'計算交易餘額錯誤: 交易不存在、未確認或無權限存取'\u001b[39m","stack":"Error: 交易不存在、未確認或無權限存取\n    at Function.calculateTransactionBalance (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:501:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:570:7)","timestamp":"2025-08-12 00:41:48:4148"}
{"existingAccountIds":[],"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'缺少的科目 ID:'\u001b[39m","missingAccountIds":["nonexistent"],"queryConditions":{"uniqueAccountIds":["nonexistent"],"userId":"user123"},"timestamp":"2025-08-12 00:41:48:4148"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'創建自動會計分錄時發生錯誤: 部分會計科目不存在'\u001b[39m","stack":"Error: 部分會計科目不存在\n    at Function.getAccountDetails (D:\\pharmacy-pos\\backend\\services\\AutoAccountingEntryService.ts:210:13)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Function.handlePurchaseOrderCompletion (D:\\pharmacy-pos\\backend\\services\\AutoAccountingEntryService.ts:30:24)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\__tests__\\AutoAccountingEntryService.test.ts:241:7)","timestamp":"2025-08-12 00:41:50:4150"}
{"error":"Database error","level":"\u001b[31merror\u001b[39m","message":"\u001b[31m建立交易錯誤\u001b[39m","timestamp":"2025-08-12 00:41:54:4154"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31m更新庫存時出錯: medicine validation failed: category: Cast to ObjectId failed for value \"管制藥\" (type string) at path \"category\" because of \"BSONError\"\u001b[39m","timestamp":"2025-08-18 10:27:28:2728"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31m更新庫存時出錯: medicine validation failed: category: Cast to ObjectId failed for value \"\" (type string) at path \"category\" because of \"BSONError\"\u001b[39m","timestamp":"2025-08-21 14:56:34:5634"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31m更新庫存時出錯: medicine validation failed: category: Cast to ObjectId failed for value \"\" (type string) at path \"category\" because of \"BSONError\"\u001b[39m","timestamp":"2025-08-21 14:56:34:5634"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31m更新庫存時出錯: medicine validation failed: category: Cast to ObjectId failed for value \"\" (type string) at path \"category\" because of \"BSONError\"\u001b[39m","timestamp":"2025-08-22 11:39:35:3935"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31m更新庫存時出錯: medicine validation failed: category: Cast to ObjectId failed for value \"\" (type string) at path \"category\" because of \"BSONError\"\u001b[39m","timestamp":"2025-08-22 14:50:38:5038"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31m更新庫存時出錯: medicine validation failed: category: Cast to ObjectId failed for value \"\" (type string) at path \"category\" because of \"BSONError\"\u001b[39m","timestamp":"2025-08-28 11:56:16:5616"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31m更新庫存時出錯: medicine validation failed: category: Cast to ObjectId failed for value \"\" (type string) at path \"category\" because of \"BSONError\"\u001b[39m","timestamp":"2025-08-29 13:37:39:3739"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31m更新庫存時出錯: medicine validation failed: category: Cast to ObjectId failed for value \"\" (type string) at path \"category\" because of \"BSONError\"\u001b[39m","timestamp":"2025-08-30 09:30:54:3054"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31m更新庫存時出錯: medicine validation failed: category: Cast to ObjectId failed for value \"\" (type string) at path \"category\" because of \"BSONError\"\u001b[39m","timestamp":"2025-09-01 01:22:09:229"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31m更新庫存時出錯: medicine validation failed: category: Cast to ObjectId failed for value \"\" (type string) at path \"category\" because of \"BSONError\"\u001b[39m","timestamp":"2025-09-01 01:22:09:229"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31m更新庫存時出錯: medicine validation failed: category: Cast to ObjectId failed for value \"\" (type string) at path \"category\" because of \"BSONError\"\u001b[39m","timestamp":"2025-09-01 11:01:43:143"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31m更新庫存時出錯: medicine validation failed: category: Cast to ObjectId failed for value \"\" (type string) at path \"category\" because of \"BSONError\"\u001b[39m","timestamp":"2025-09-01 11:01:43:143"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31mFIFO健保碼模擬計算錯誤: calculateProfitMargins is not defined\u001b[39m","timestamp":"2025-09-02 14:48:22:4822"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31mFIFO健保碼模擬計算錯誤: calculateProfitMargins is not defined\u001b[39m","timestamp":"2025-09-02 14:53:16:5316"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31mFIFO健保碼模擬計算錯誤: calculateProfitMargins is not defined\u001b[39m","timestamp":"2025-09-02 15:27:52:2752"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31m更新庫存時出錯: medicine validation failed: category: Cast to ObjectId failed for value \"\" (type string) at path \"category\" because of \"BSONError\"\u001b[39m","timestamp":"2025-09-03 07:56:05:565"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31m更新庫存時出錯: product validation failed: category: Cast to ObjectId failed for value \"口罩\" (type string) at path \"category\" because of \"BSONError\"\u001b[39m","timestamp":"2025-09-03 08:12:53:1253"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31m創建不扣庫存產品的毛利記錄時出錯: inventory validation failed: type: `ship-no-stock` is not a valid enum value for path `type`.\u001b[39m","timestamp":"2025-09-03 09:19:52:1952"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31m創建不扣庫存產品的毛利記錄時出錯: inventory validation failed: type: `ship-no-stock` is not a valid enum value for path `type`.\u001b[39m","timestamp":"2025-09-03 09:20:26:2026"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31m更新庫存時出錯: medicine validation failed: category: Cast to ObjectId failed for value \"\" (type string) at path \"category\" because of \"BSONError\"\u001b[39m","timestamp":"2025-09-04 00:51:14:5114"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31m更新庫存時出錯: medicine validation failed: category: Cast to ObjectId failed for value \"\" (type string) at path \"category\" because of \"BSONError\"\u001b[39m","timestamp":"2025-09-04 11:47:52:4752"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31m更新庫存時出錯: medicine validation failed: category: Cast to ObjectId failed for value \"\" (type string) at path \"category\" because of \"BSONError\"\u001b[39m","timestamp":"2025-09-04 11:47:52:4752"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31m更新庫存時出錯: medicine validation failed: category: Cast to ObjectId failed for value \"\" (type string) at path \"category\" because of \"BSONError\"\u001b[39m","timestamp":"2025-09-04 11:47:52:4752"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31m更新庫存時出錯: medicine validation failed: category: Cast to ObjectId failed for value \"\" (type string) at path \"category\" because of \"BSONError\"\u001b[39m","timestamp":"2025-09-04 11:57:30:5730"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31m更新庫存時出錯: medicine validation failed: category: Cast to ObjectId failed for value \"\" (type string) at path \"category\" because of \"BSONError\"\u001b[39m","timestamp":"2025-09-04 11:57:30:5730"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31m更新庫存時出錯: medicine validation failed: category: Cast to ObjectId failed for value \"\" (type string) at path \"category\" because of \"BSONError\"\u001b[39m","timestamp":"2025-09-04 11:59:03:593"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31m更新庫存時出錯: medicine validation failed: category: Cast to ObjectId failed for value \"\" (type string) at path \"category\" because of \"BSONError\"\u001b[39m","timestamp":"2025-09-08 17:17:29:1729"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31m更新庫存時出錯: medicine validation failed: category: Cast to ObjectId failed for value \"\" (type string) at path \"category\" because of \"BSONError\"\u001b[39m","timestamp":"2025-09-08 17:17:29:1729"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31m更新庫存時出錯: medicine validation failed: category: Cast to ObjectId failed for value \"\" (type string) at path \"category\" because of \"BSONError\"\u001b[39m","timestamp":"2025-09-08 18:45:10:4510"}
{"code":11000,"errorLabelSet":{},"errorResponse":{"code":11000,"errmsg":"E11000 duplicate key error collection: pharmacy-pos.transactionGroups index: groupNumber_1 dup key: { groupNumber: \"TXN-20250909-001\" }","index":0,"keyPattern":{"groupNumber":1},"keyValue":{"groupNumber":"TXN-20250909-001"}},"index":0,"keyPattern":{"groupNumber":1},"keyValue":{"groupNumber":"TXN-20250909-001"},"level":"\u001b[31merror\u001b[39m","message":"\u001b[31m創建自動會計分錄時發生錯誤: E11000 duplicate key error collection: pharmacy-pos.transactionGroups index: groupNumber_1 dup key: { groupNumber: \"TXN-20250909-001\" }\u001b[39m","stack":"MongoServerError: E11000 duplicate key error collection: pharmacy-pos.transactionGroups index: groupNumber_1 dup key: { groupNumber: \"TXN-20250909-001\" }\n    at InsertOneOperation.execute (D:\\pharmacy-pos\\node_modules\\.pnpm\\mongodb@6.17.0_socks@2.8.5\\node_modules\\mongodb\\src\\operations\\insert.ts:88:13)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async tryOperation (D:\\pharmacy-pos\\node_modules\\.pnpm\\mongodb@6.17.0_socks@2.8.5\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:283:14)\n    at async executeOperation (D:\\pharmacy-pos\\node_modules\\.pnpm\\mongodb@6.17.0_socks@2.8.5\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:115:12)\n    at async Collection.insertOne (D:\\pharmacy-pos\\node_modules\\.pnpm\\mongodb@6.17.0_socks@2.8.5\\node_modules\\mongodb\\src\\collection.ts:286:12)","timestamp":"2025-09-09 20:30:33:3033"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31m處理會計整合時出錯: E11000 duplicate key error collection: pharmacy-pos.transactionGroups index: groupNumber_1 dup key: { groupNumber: \"TXN-20250909-001\" }\u001b[39m","timestamp":"2025-09-09 20:30:33:3033"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31m更新庫存時出錯: medicine validation failed: category: Cast to ObjectId failed for value \"\" (type string) at path \"category\" because of \"BSONError\"\u001b[39m","timestamp":"2025-09-11 16:12:18:1218"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31m更新庫存時出錯: medicine validation failed: category: Cast to ObjectId failed for value \"\" (type string) at path \"category\" because of \"BSONError\"\u001b[39m","timestamp":"2025-09-11 20:47:26:4726"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31m更新庫存時出錯: product validation failed: category: Cast to ObjectId failed for value \"\" (type string) at path \"category\" because of \"BSONError\"\u001b[39m","timestamp":"2025-09-11 20:47:26:4726"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31m資料庫錯誤: read ECONNRESET\u001b[39m","timestamp":"2025-09-12 12:01:46:146"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31m更新庫存時出錯: medicine validation failed: category: Cast to ObjectId failed for value \"急性\" (type string) at path \"category\" because of \"BSONError\"\u001b[39m","timestamp":"2025-09-13 11:29:38:2938"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31m更新庫存時出錯: medicine validation failed: category: Cast to ObjectId failed for value \"\" (type string) at path \"category\" because of \"BSONError\"\u001b[39m","timestamp":"2025-09-13 12:14:58:1458"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31m更新庫存時出錯: medicine validation failed: category: Cast to ObjectId failed for value \"\" (type string) at path \"category\" because of \"BSONError\"\u001b[39m","timestamp":"2025-09-13 12:14:58:1458"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31m更新庫存時出錯: medicine validation failed: category: Cast to ObjectId failed for value \"\" (type string) at path \"category\" because of \"BSONError\"\u001b[39m","timestamp":"2025-09-13 12:14:58:1458"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31m創建進貨單錯誤: purchaseorder validation failed: transactionType: `` is not a valid enum value for path `transactionType`.\u001b[39m","timestamp":"2025-09-28 18:39:31:3931"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31mFailed to create sale: items is not iterable\u001b[39m","timestamp":"2025-09-29 11:47:07:477"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31mFailed to list sales: Database connection failed\u001b[39m","timestamp":"2025-09-29 11:47:08:478"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31mFailed to create sale: items is not iterable\u001b[39m","timestamp":"2025-09-29 11:47:08:478"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31m創建銷售記錄錯誤: items is not iterable\u001b[39m","timestamp":"2025-09-29 11:58:49:5849"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31m創建銷售記錄錯誤: 產品ID 68da03f9ee78ade7ef8d0147 不存在\u001b[39m","timestamp":"2025-09-29 11:58:49:5849"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31m創建銷售記錄錯誤: 客戶不存在\u001b[39m","timestamp":"2025-09-29 11:58:49:5849"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31m獲取銷售記錄錯誤: Database connection failed\u001b[39m","timestamp":"2025-09-29 11:58:50:5850"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31m創建銷售記錄錯誤: items is not iterable\u001b[39m","timestamp":"2025-09-29 11:58:50:5850"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31mFailed to create supplier: supplier validation failed: name: Path `name` is required.\u001b[39m","timestamp":"2025-09-29 11:58:53:5853"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31mFailed to list suppliers: Database connection failed\u001b[39m","timestamp":"2025-09-29 11:58:54:5854"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31mFailed to create supplier: supplier validation failed: name: Path `name` is required.\u001b[39m","timestamp":"2025-09-29 11:58:55:5855"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31mFailed to list customers: Database connection failed\u001b[39m","timestamp":"2025-09-29 11:59:13:5913"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'建立交易群組錯誤: 交易群組編號 TXN001 已存在'\u001b[39m","stack":"Error: 交易群組編號 TXN001 已存在\n    at Function.createTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:35:17)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:102:7)","timestamp":"2025-09-29 11:59:46:5946"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'取得交易群組詳細資料錯誤: 交易群組不存在或無權限存取'\u001b[39m","stack":"Error: 交易群組不存在或無權限存取\n    at Function.getTransactionGroupById (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:162:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:235:7)","timestamp":"2025-09-29 11:59:46:5946"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'更新交易群組錯誤: 交易群組不存在或無權限存取'\u001b[39m","stack":"Error: 交易群組不存在或無權限存取\n    at Function.updateTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:221:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:333:7)","timestamp":"2025-09-29 11:59:46:5946"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'更新交易群組錯誤: 已確認的交易無法修改'\u001b[39m","stack":"Error: 已確認的交易無法修改\n    at Function.updateTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:226:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:344:7)","timestamp":"2025-09-29 11:59:46:5946"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'更新交易群組錯誤: 交易群組編號 NEW001 已存在'\u001b[39m","stack":"Error: 交易群組編號 NEW001 已存在\n    at Function.updateTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:238:17)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:358:7)","timestamp":"2025-09-29 11:59:46:5946"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 交易群組不存在或無權限存取'\u001b[39m","stack":"Error: 交易群組不存在或無權限存取\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:286:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:402:7)","timestamp":"2025-09-29 11:59:46:5946"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 交易群組已經確認'\u001b[39m","stack":"Error: 交易群組已經確認\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:290:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:413:7)","timestamp":"2025-09-29 11:59:46:5946"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 已取消的交易無法確認'\u001b[39m","stack":"Error: 已取消的交易無法確認\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:294:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:424:7)","timestamp":"2025-09-29 11:59:46:5946"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 交易群組必須包含分錄才能確認'\u001b[39m","stack":"Error: 交易群組必須包含分錄才能確認\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:299:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:439:7)","timestamp":"2025-09-29 11:59:46:5946"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 交易借貸不平衡：借方 1000，貸方 500'\u001b[39m","stack":"Error: 交易借貸不平衡：借方 1000，貸方 500\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:307:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:457:7)","timestamp":"2025-09-29 11:59:46:5946"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'取消交易群組錯誤: 交易群組不存在或無權限存取'\u001b[39m","stack":"Error: 交易群組不存在或無權限存取\n    at Function.cancelTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:352:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:495:7)","timestamp":"2025-09-29 11:59:46:5946"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'取消交易群組錯誤: 交易群組已經取消'\u001b[39m","stack":"Error: 交易群組已經取消\n    at Function.cancelTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:356:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:506:7)","timestamp":"2025-09-29 11:59:46:5946"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'取消交易群組錯誤: 無法取消交易：有 2 筆交易引用此交易'\u001b[39m","stack":"Error: 無法取消交易：有 2 筆交易引用此交易\n    at Function.cancelTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:367:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:520:7)","timestamp":"2025-09-29 11:59:46:5946"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'計算交易餘額錯誤: 交易不存在、未確認或無權限存取'\u001b[39m","stack":"Error: 交易不存在、未確認或無權限存取\n    at Function.calculateTransactionBalance (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:501:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:570:7)","timestamp":"2025-09-29 11:59:46:5946"}
{"existingAccountIds":[],"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'缺少的科目 ID:'\u001b[39m","missingAccountIds":["nonexistent"],"queryConditions":{"uniqueAccountIds":["nonexistent"],"userId":"user123"},"timestamp":"2025-09-29 11:59:46:5946"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'創建自動會計分錄時發生錯誤: 部分會計科目不存在'\u001b[39m","stack":"Error: 部分會計科目不存在\n    at Function.getAccountDetails (D:\\pharmacy-pos\\backend\\services\\AutoAccountingEntryService.ts:210:13)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Function.handlePurchaseOrderCompletion (D:\\pharmacy-pos\\backend\\services\\AutoAccountingEntryService.ts:30:24)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\__tests__\\AutoAccountingEntryService.test.ts:241:7)","timestamp":"2025-09-29 11:59:53:5953"}
{"error":"Database error","level":"\u001b[31merror\u001b[39m","message":"\u001b[31m建立交易錯誤\u001b[39m","timestamp":"2025-09-29 11:59:57:5957"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31m創建銷售記錄錯誤: 資料驗證失敗\u001b[39m","timestamp":"2025-09-29 12:17:43:1743"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31m創建銷售記錄錯誤: 產品ID 68da0867afc151971d5b8e78 不存在\u001b[39m","timestamp":"2025-09-29 12:17:43:1743"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31m創建銷售記錄錯誤: 找不到客戶\u001b[39m","timestamp":"2025-09-29 12:17:43:1743"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31m更新銷售記錄失敗: 資料驗證失敗\u001b[39m","timestamp":"2025-09-29 12:17:43:1743"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31m獲取銷售記錄錯誤: Database connection failed\u001b[39m","timestamp":"2025-09-29 12:17:44:1744"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31m創建銷售記錄錯誤: 資料驗證失敗\u001b[39m","timestamp":"2025-09-29 12:17:44:1744"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31mFailed to list suppliers: Database connection failed\u001b[39m","timestamp":"2025-09-29 12:17:48:1748"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31mFailed to list customers: Database connection failed\u001b[39m","timestamp":"2025-09-29 12:18:10:1810"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'建立交易群組錯誤: 交易群組編號 TXN001 已存在'\u001b[39m","stack":"Error: 交易群組編號 TXN001 已存在\n    at Function.createTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:35:17)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:102:7)","timestamp":"2025-09-29 12:18:38:1838"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'取得交易群組詳細資料錯誤: 交易群組不存在或無權限存取'\u001b[39m","stack":"Error: 交易群組不存在或無權限存取\n    at Function.getTransactionGroupById (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:162:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:235:7)","timestamp":"2025-09-29 12:18:38:1838"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'更新交易群組錯誤: 交易群組不存在或無權限存取'\u001b[39m","stack":"Error: 交易群組不存在或無權限存取\n    at Function.updateTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:221:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:333:7)","timestamp":"2025-09-29 12:18:38:1838"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'更新交易群組錯誤: 已確認的交易無法修改'\u001b[39m","stack":"Error: 已確認的交易無法修改\n    at Function.updateTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:226:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:344:7)","timestamp":"2025-09-29 12:18:38:1838"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'更新交易群組錯誤: 交易群組編號 NEW001 已存在'\u001b[39m","stack":"Error: 交易群組編號 NEW001 已存在\n    at Function.updateTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:238:17)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:358:7)","timestamp":"2025-09-29 12:18:38:1838"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 交易群組不存在或無權限存取'\u001b[39m","stack":"Error: 交易群組不存在或無權限存取\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:286:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:402:7)","timestamp":"2025-09-29 12:18:38:1838"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 交易群組已經確認'\u001b[39m","stack":"Error: 交易群組已經確認\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:290:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:413:7)","timestamp":"2025-09-29 12:18:38:1838"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 已取消的交易無法確認'\u001b[39m","stack":"Error: 已取消的交易無法確認\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:294:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:424:7)","timestamp":"2025-09-29 12:18:38:1838"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 交易群組必須包含分錄才能確認'\u001b[39m","stack":"Error: 交易群組必須包含分錄才能確認\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:299:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:439:7)","timestamp":"2025-09-29 12:18:38:1838"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 交易借貸不平衡：借方 1000，貸方 500'\u001b[39m","stack":"Error: 交易借貸不平衡：借方 1000，貸方 500\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:307:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:457:7)","timestamp":"2025-09-29 12:18:38:1838"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'取消交易群組錯誤: 交易群組不存在或無權限存取'\u001b[39m","stack":"Error: 交易群組不存在或無權限存取\n    at Function.cancelTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:352:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:495:7)","timestamp":"2025-09-29 12:18:38:1838"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'取消交易群組錯誤: 交易群組已經取消'\u001b[39m","stack":"Error: 交易群組已經取消\n    at Function.cancelTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:356:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:506:7)","timestamp":"2025-09-29 12:18:38:1838"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'取消交易群組錯誤: 無法取消交易：有 2 筆交易引用此交易'\u001b[39m","stack":"Error: 無法取消交易：有 2 筆交易引用此交易\n    at Function.cancelTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:367:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:520:7)","timestamp":"2025-09-29 12:18:38:1838"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'計算交易餘額錯誤: 交易不存在、未確認或無權限存取'\u001b[39m","stack":"Error: 交易不存在、未確認或無權限存取\n    at Function.calculateTransactionBalance (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:501:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:570:7)","timestamp":"2025-09-29 12:18:38:1838"}
{"existingAccountIds":[],"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'缺少的科目 ID:'\u001b[39m","missingAccountIds":["nonexistent"],"queryConditions":{"uniqueAccountIds":["nonexistent"],"userId":"user123"},"timestamp":"2025-09-29 12:18:38:1838"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'創建自動會計分錄時發生錯誤: 部分會計科目不存在'\u001b[39m","stack":"Error: 部分會計科目不存在\n    at Function.getAccountDetails (D:\\pharmacy-pos\\backend\\services\\AutoAccountingEntryService.ts:210:13)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Function.handlePurchaseOrderCompletion (D:\\pharmacy-pos\\backend\\services\\AutoAccountingEntryService.ts:30:24)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\__tests__\\AutoAccountingEntryService.test.ts:241:7)","timestamp":"2025-09-29 12:18:49:1849"}
{"error":"Database error","level":"\u001b[31merror\u001b[39m","message":"\u001b[31m建立交易錯誤\u001b[39m","timestamp":"2025-09-29 12:18:54:1854"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'建立交易群組錯誤: 交易群組編號 TXN001 已存在'\u001b[39m","stack":"Error: 交易群組編號 TXN001 已存在\n    at Function.createTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:35:17)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:102:7)","timestamp":"2025-09-29 20:50:47:5047"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'取得交易群組詳細資料錯誤: 交易群組不存在或無權限存取'\u001b[39m","stack":"Error: 交易群組不存在或無權限存取\n    at Function.getTransactionGroupById (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:162:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:235:7)","timestamp":"2025-09-29 20:50:47:5047"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'更新交易群組錯誤: 交易群組不存在或無權限存取'\u001b[39m","stack":"Error: 交易群組不存在或無權限存取\n    at Function.updateTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:221:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:333:7)","timestamp":"2025-09-29 20:50:47:5047"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'更新交易群組錯誤: 已確認的交易無法修改'\u001b[39m","stack":"Error: 已確認的交易無法修改\n    at Function.updateTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:226:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:344:7)","timestamp":"2025-09-29 20:50:47:5047"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'更新交易群組錯誤: 交易群組編號 NEW001 已存在'\u001b[39m","stack":"Error: 交易群組編號 NEW001 已存在\n    at Function.updateTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:238:17)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:358:7)","timestamp":"2025-09-29 20:50:47:5047"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 交易群組不存在或無權限存取'\u001b[39m","stack":"Error: 交易群組不存在或無權限存取\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:286:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:402:7)","timestamp":"2025-09-29 20:50:47:5047"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 交易群組已經確認'\u001b[39m","stack":"Error: 交易群組已經確認\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:290:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:413:7)","timestamp":"2025-09-29 20:50:47:5047"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 已取消的交易無法確認'\u001b[39m","stack":"Error: 已取消的交易無法確認\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:294:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:424:7)","timestamp":"2025-09-29 20:50:47:5047"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 交易群組必須包含分錄才能確認'\u001b[39m","stack":"Error: 交易群組必須包含分錄才能確認\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:299:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:439:7)","timestamp":"2025-09-29 20:50:47:5047"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 交易借貸不平衡：借方 1000，貸方 500'\u001b[39m","stack":"Error: 交易借貸不平衡：借方 1000，貸方 500\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:307:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:457:7)","timestamp":"2025-09-29 20:50:47:5047"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'取消交易群組錯誤: 交易群組不存在或無權限存取'\u001b[39m","stack":"Error: 交易群組不存在或無權限存取\n    at Function.cancelTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:352:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:495:7)","timestamp":"2025-09-29 20:50:47:5047"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'取消交易群組錯誤: 交易群組已經取消'\u001b[39m","stack":"Error: 交易群組已經取消\n    at Function.cancelTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:356:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:506:7)","timestamp":"2025-09-29 20:50:47:5047"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'取消交易群組錯誤: 無法取消交易：有 2 筆交易引用此交易'\u001b[39m","stack":"Error: 無法取消交易：有 2 筆交易引用此交易\n    at Function.cancelTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:367:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:520:7)","timestamp":"2025-09-29 20:50:47:5047"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'計算交易餘額錯誤: 交易不存在、未確認或無權限存取'\u001b[39m","stack":"Error: 交易不存在、未確認或無權限存取\n    at Function.calculateTransactionBalance (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:501:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:570:7)","timestamp":"2025-09-29 20:50:47:5047"}
{"existingAccountIds":[],"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'缺少的科目 ID:'\u001b[39m","missingAccountIds":["nonexistent"],"queryConditions":{"uniqueAccountIds":["nonexistent"],"userId":"user123"},"timestamp":"2025-09-29 20:50:47:5047"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'創建自動會計分錄時發生錯誤: 部分會計科目不存在'\u001b[39m","stack":"Error: 部分會計科目不存在\n    at Function.getAccountDetails (D:\\pharmacy-pos\\backend\\services\\AutoAccountingEntryService.ts:210:13)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Function.handlePurchaseOrderCompletion (D:\\pharmacy-pos\\backend\\services\\AutoAccountingEntryService.ts:30:24)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\__tests__\\AutoAccountingEntryService.test.ts:241:7)","timestamp":"2025-09-29 20:50:50:5050"}
{"error":"Database error","level":"\u001b[31merror\u001b[39m","message":"\u001b[31m建立交易錯誤\u001b[39m","timestamp":"2025-09-29 20:51:00:510"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31m創建銷售記錄錯誤: 資料驗證失敗\u001b[39m","timestamp":"2025-09-29 20:56:00:560"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31m創建銷售記錄錯誤: 產品ID 68da81e1794b60ade040e90e 不存在\u001b[39m","timestamp":"2025-09-29 20:56:01:561"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31m創建銷售記錄錯誤: 找不到客戶\u001b[39m","timestamp":"2025-09-29 20:56:01:561"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31m獲取銷售記錄錯誤: Database connection failed\u001b[39m","timestamp":"2025-09-29 20:56:02:562"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31m創建銷售記錄錯誤: 資料驗證失敗\u001b[39m","timestamp":"2025-09-29 20:56:02:562"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31mFailed to list suppliers: Database connection failed\u001b[39m","timestamp":"2025-09-29 20:56:09:569"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31mFailed to list customers: Database connection failed\u001b[39m","timestamp":"2025-09-29 20:56:20:5620"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'建立交易群組錯誤: 交易群組編號 TXN001 已存在'\u001b[39m","stack":"Error: 交易群組編號 TXN001 已存在\n    at Function.createTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:35:17)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:102:7)","timestamp":"2025-09-29 20:56:50:5650"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'取得交易群組詳細資料錯誤: 交易群組不存在或無權限存取'\u001b[39m","stack":"Error: 交易群組不存在或無權限存取\n    at Function.getTransactionGroupById (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:162:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:235:7)","timestamp":"2025-09-29 20:56:51:5651"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'更新交易群組錯誤: 交易群組不存在或無權限存取'\u001b[39m","stack":"Error: 交易群組不存在或無權限存取\n    at Function.updateTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:221:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:333:7)","timestamp":"2025-09-29 20:56:51:5651"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'更新交易群組錯誤: 已確認的交易無法修改'\u001b[39m","stack":"Error: 已確認的交易無法修改\n    at Function.updateTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:226:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:344:7)","timestamp":"2025-09-29 20:56:51:5651"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'更新交易群組錯誤: 交易群組編號 NEW001 已存在'\u001b[39m","stack":"Error: 交易群組編號 NEW001 已存在\n    at Function.updateTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:238:17)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:358:7)","timestamp":"2025-09-29 20:56:51:5651"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 交易群組不存在或無權限存取'\u001b[39m","stack":"Error: 交易群組不存在或無權限存取\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:286:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:402:7)","timestamp":"2025-09-29 20:56:51:5651"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 交易群組已經確認'\u001b[39m","stack":"Error: 交易群組已經確認\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:290:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:413:7)","timestamp":"2025-09-29 20:56:51:5651"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 已取消的交易無法確認'\u001b[39m","stack":"Error: 已取消的交易無法確認\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:294:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:424:7)","timestamp":"2025-09-29 20:56:51:5651"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 交易群組必須包含分錄才能確認'\u001b[39m","stack":"Error: 交易群組必須包含分錄才能確認\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:299:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:439:7)","timestamp":"2025-09-29 20:56:51:5651"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 交易借貸不平衡：借方 1000，貸方 500'\u001b[39m","stack":"Error: 交易借貸不平衡：借方 1000，貸方 500\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:307:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:457:7)","timestamp":"2025-09-29 20:56:51:5651"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'取消交易群組錯誤: 交易群組不存在或無權限存取'\u001b[39m","stack":"Error: 交易群組不存在或無權限存取\n    at Function.cancelTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:352:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:495:7)","timestamp":"2025-09-29 20:56:51:5651"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'取消交易群組錯誤: 交易群組已經取消'\u001b[39m","stack":"Error: 交易群組已經取消\n    at Function.cancelTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:356:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:506:7)","timestamp":"2025-09-29 20:56:51:5651"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'取消交易群組錯誤: 無法取消交易：有 2 筆交易引用此交易'\u001b[39m","stack":"Error: 無法取消交易：有 2 筆交易引用此交易\n    at Function.cancelTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:367:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:520:7)","timestamp":"2025-09-29 20:56:51:5651"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'計算交易餘額錯誤: 交易不存在、未確認或無權限存取'\u001b[39m","stack":"Error: 交易不存在、未確認或無權限存取\n    at Function.calculateTransactionBalance (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:501:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:570:7)","timestamp":"2025-09-29 20:56:51:5651"}
{"existingAccountIds":[],"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'缺少的科目 ID:'\u001b[39m","missingAccountIds":["nonexistent"],"queryConditions":{"uniqueAccountIds":["nonexistent"],"userId":"user123"},"timestamp":"2025-09-29 20:56:51:5651"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'創建自動會計分錄時發生錯誤: 部分會計科目不存在'\u001b[39m","stack":"Error: 部分會計科目不存在\n    at Function.getAccountDetails (D:\\pharmacy-pos\\backend\\services\\AutoAccountingEntryService.ts:210:13)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Function.handlePurchaseOrderCompletion (D:\\pharmacy-pos\\backend\\services\\AutoAccountingEntryService.ts:30:24)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\__tests__\\AutoAccountingEntryService.test.ts:241:7)","timestamp":"2025-09-29 20:57:00:570"}
{"error":"Database error","level":"\u001b[31merror\u001b[39m","message":"\u001b[31m建立交易錯誤\u001b[39m","timestamp":"2025-09-29 20:57:04:574"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31m創建銷售記錄錯誤: 資料驗證失敗\u001b[39m","timestamp":"2025-09-29 21:05:44:544"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31m創建銷售記錄錯誤: 產品ID 68da842803ded644d262ce80 不存在\u001b[39m","timestamp":"2025-09-29 21:05:44:544"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31m創建銷售記錄錯誤: 找不到客戶\u001b[39m","timestamp":"2025-09-29 21:05:44:544"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31m獲取銷售記錄錯誤: Database connection failed\u001b[39m","timestamp":"2025-09-29 21:05:45:545"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31m創建銷售記錄錯誤: 資料驗證失敗\u001b[39m","timestamp":"2025-09-29 21:05:45:545"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31mFailed to list suppliers: Database connection failed\u001b[39m","timestamp":"2025-09-29 21:05:53:553"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31mFailed to list customers: Database connection failed\u001b[39m","timestamp":"2025-09-29 21:06:08:68"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'建立交易群組錯誤: 交易群組編號 TXN001 已存在'\u001b[39m","stack":"Error: 交易群組編號 TXN001 已存在\n    at Function.createTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:35:17)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:102:7)","timestamp":"2025-09-29 21:06:37:637"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'取得交易群組詳細資料錯誤: 交易群組不存在或無權限存取'\u001b[39m","stack":"Error: 交易群組不存在或無權限存取\n    at Function.getTransactionGroupById (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:162:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:235:7)","timestamp":"2025-09-29 21:06:37:637"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'更新交易群組錯誤: 交易群組不存在或無權限存取'\u001b[39m","stack":"Error: 交易群組不存在或無權限存取\n    at Function.updateTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:221:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:333:7)","timestamp":"2025-09-29 21:06:37:637"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'更新交易群組錯誤: 已確認的交易無法修改'\u001b[39m","stack":"Error: 已確認的交易無法修改\n    at Function.updateTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:226:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:344:7)","timestamp":"2025-09-29 21:06:37:637"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'更新交易群組錯誤: 交易群組編號 NEW001 已存在'\u001b[39m","stack":"Error: 交易群組編號 NEW001 已存在\n    at Function.updateTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:238:17)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:358:7)","timestamp":"2025-09-29 21:06:37:637"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 交易群組不存在或無權限存取'\u001b[39m","stack":"Error: 交易群組不存在或無權限存取\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:286:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:402:7)","timestamp":"2025-09-29 21:06:37:637"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 交易群組已經確認'\u001b[39m","stack":"Error: 交易群組已經確認\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:290:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:413:7)","timestamp":"2025-09-29 21:06:37:637"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 已取消的交易無法確認'\u001b[39m","stack":"Error: 已取消的交易無法確認\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:294:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:424:7)","timestamp":"2025-09-29 21:06:37:637"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 交易群組必須包含分錄才能確認'\u001b[39m","stack":"Error: 交易群組必須包含分錄才能確認\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:299:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:439:7)","timestamp":"2025-09-29 21:06:37:637"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 交易借貸不平衡：借方 1000，貸方 500'\u001b[39m","stack":"Error: 交易借貸不平衡：借方 1000，貸方 500\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:307:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:457:7)","timestamp":"2025-09-29 21:06:37:637"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'取消交易群組錯誤: 交易群組不存在或無權限存取'\u001b[39m","stack":"Error: 交易群組不存在或無權限存取\n    at Function.cancelTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:352:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:495:7)","timestamp":"2025-09-29 21:06:37:637"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'取消交易群組錯誤: 交易群組已經取消'\u001b[39m","stack":"Error: 交易群組已經取消\n    at Function.cancelTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:356:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:506:7)","timestamp":"2025-09-29 21:06:37:637"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'取消交易群組錯誤: 無法取消交易：有 2 筆交易引用此交易'\u001b[39m","stack":"Error: 無法取消交易：有 2 筆交易引用此交易\n    at Function.cancelTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:367:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:520:7)","timestamp":"2025-09-29 21:06:37:637"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'計算交易餘額錯誤: 交易不存在、未確認或無權限存取'\u001b[39m","stack":"Error: 交易不存在、未確認或無權限存取\n    at Function.calculateTransactionBalance (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:501:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:570:7)","timestamp":"2025-09-29 21:06:37:637"}
{"existingAccountIds":[],"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'缺少的科目 ID:'\u001b[39m","missingAccountIds":["nonexistent"],"queryConditions":{"uniqueAccountIds":["nonexistent"],"userId":"user123"},"timestamp":"2025-09-29 21:06:37:637"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'創建自動會計分錄時發生錯誤: 部分會計科目不存在'\u001b[39m","stack":"Error: 部分會計科目不存在\n    at Function.getAccountDetails (D:\\pharmacy-pos\\backend\\services\\AutoAccountingEntryService.ts:210:13)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Function.handlePurchaseOrderCompletion (D:\\pharmacy-pos\\backend\\services\\AutoAccountingEntryService.ts:30:24)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\__tests__\\AutoAccountingEntryService.test.ts:241:7)","timestamp":"2025-09-29 21:06:46:646"}
{"error":"Database error","level":"\u001b[31merror\u001b[39m","message":"\u001b[31m建立交易錯誤\u001b[39m","timestamp":"2025-09-29 21:06:52:652"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31m創建銷售記錄錯誤: 資料驗證失敗\u001b[39m","timestamp":"2025-09-29 21:08:12:812"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31m創建銷售記錄錯誤: 產品ID 68da84bcf102212665d658f5 不存在\u001b[39m","timestamp":"2025-09-29 21:08:12:812"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31m創建銷售記錄錯誤: 找不到客戶\u001b[39m","timestamp":"2025-09-29 21:08:12:812"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31m獲取銷售記錄錯誤: Database connection failed\u001b[39m","timestamp":"2025-09-29 21:08:13:813"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31m創建銷售記錄錯誤: 資料驗證失敗\u001b[39m","timestamp":"2025-09-29 21:08:14:814"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31mFailed to list suppliers: Database connection failed\u001b[39m","timestamp":"2025-09-29 21:08:23:823"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31mFailed to list customers: Database connection failed\u001b[39m","timestamp":"2025-09-29 21:08:39:839"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'建立交易群組錯誤: 交易群組編號 TXN001 已存在'\u001b[39m","stack":"Error: 交易群組編號 TXN001 已存在\n    at Function.createTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:35:17)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:102:7)","timestamp":"2025-09-29 21:09:18:918"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'取得交易群組詳細資料錯誤: 交易群組不存在或無權限存取'\u001b[39m","stack":"Error: 交易群組不存在或無權限存取\n    at Function.getTransactionGroupById (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:162:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:235:7)","timestamp":"2025-09-29 21:09:18:918"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'更新交易群組錯誤: 交易群組不存在或無權限存取'\u001b[39m","stack":"Error: 交易群組不存在或無權限存取\n    at Function.updateTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:221:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:333:7)","timestamp":"2025-09-29 21:09:18:918"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'更新交易群組錯誤: 已確認的交易無法修改'\u001b[39m","stack":"Error: 已確認的交易無法修改\n    at Function.updateTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:226:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:344:7)","timestamp":"2025-09-29 21:09:18:918"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'更新交易群組錯誤: 交易群組編號 NEW001 已存在'\u001b[39m","stack":"Error: 交易群組編號 NEW001 已存在\n    at Function.updateTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:238:17)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:358:7)","timestamp":"2025-09-29 21:09:18:918"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 交易群組不存在或無權限存取'\u001b[39m","stack":"Error: 交易群組不存在或無權限存取\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:286:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:402:7)","timestamp":"2025-09-29 21:09:18:918"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 交易群組已經確認'\u001b[39m","stack":"Error: 交易群組已經確認\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:290:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:413:7)","timestamp":"2025-09-29 21:09:18:918"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 已取消的交易無法確認'\u001b[39m","stack":"Error: 已取消的交易無法確認\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:294:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:424:7)","timestamp":"2025-09-29 21:09:18:918"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 交易群組必須包含分錄才能確認'\u001b[39m","stack":"Error: 交易群組必須包含分錄才能確認\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:299:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:439:7)","timestamp":"2025-09-29 21:09:18:918"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 交易借貸不平衡：借方 1000，貸方 500'\u001b[39m","stack":"Error: 交易借貸不平衡：借方 1000，貸方 500\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:307:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:457:7)","timestamp":"2025-09-29 21:09:18:918"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'取消交易群組錯誤: 交易群組不存在或無權限存取'\u001b[39m","stack":"Error: 交易群組不存在或無權限存取\n    at Function.cancelTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:352:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:495:7)","timestamp":"2025-09-29 21:09:18:918"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'取消交易群組錯誤: 交易群組已經取消'\u001b[39m","stack":"Error: 交易群組已經取消\n    at Function.cancelTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:356:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:506:7)","timestamp":"2025-09-29 21:09:18:918"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'取消交易群組錯誤: 無法取消交易：有 2 筆交易引用此交易'\u001b[39m","stack":"Error: 無法取消交易：有 2 筆交易引用此交易\n    at Function.cancelTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:367:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:520:7)","timestamp":"2025-09-29 21:09:18:918"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'計算交易餘額錯誤: 交易不存在、未確認或無權限存取'\u001b[39m","stack":"Error: 交易不存在、未確認或無權限存取\n    at Function.calculateTransactionBalance (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:501:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:570:7)","timestamp":"2025-09-29 21:09:18:918"}
{"existingAccountIds":[],"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'缺少的科目 ID:'\u001b[39m","missingAccountIds":["nonexistent"],"queryConditions":{"uniqueAccountIds":["nonexistent"],"userId":"user123"},"timestamp":"2025-09-29 21:09:18:918"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'創建自動會計分錄時發生錯誤: 部分會計科目不存在'\u001b[39m","stack":"Error: 部分會計科目不存在\n    at Function.getAccountDetails (D:\\pharmacy-pos\\backend\\services\\AutoAccountingEntryService.ts:210:13)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Function.handlePurchaseOrderCompletion (D:\\pharmacy-pos\\backend\\services\\AutoAccountingEntryService.ts:30:24)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\__tests__\\AutoAccountingEntryService.test.ts:241:7)","timestamp":"2025-09-29 21:09:26:926"}
{"error":"Database error","level":"\u001b[31merror\u001b[39m","message":"\u001b[31m建立交易錯誤\u001b[39m","timestamp":"2025-09-29 21:09:35:935"}
