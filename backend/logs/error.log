{"error":"Database error","level":"\u001b[31merror\u001b[39m","message":"\u001b[31m建立交易錯誤\u001b[39m","timestamp":"2025-08-10 14:45:27:4527"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31m創建銷售記錄錯誤: Database connection failed\u001b[39m","timestamp":"2025-08-11 22:51:50:5150"}
{"error":"Database error","level":"\u001b[31merror\u001b[39m","message":"\u001b[31m建立交易錯誤\u001b[39m","timestamp":"2025-08-11 22:52:21:5221"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'建立交易群組錯誤: 交易群組編號 TXN001 已存在'\u001b[39m","stack":"Error: 交易群組編號 TXN001 已存在\n    at Function.createTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:35:17)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:102:7)","timestamp":"2025-08-11 22:52:31:5231"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'取得交易群組詳細資料錯誤: 交易群組不存在或無權限存取'\u001b[39m","stack":"Error: 交易群組不存在或無權限存取\n    at Function.getTransactionGroupById (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:162:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:235:7)","timestamp":"2025-08-11 22:52:31:5231"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'更新交易群組錯誤: 交易群組不存在或無權限存取'\u001b[39m","stack":"Error: 交易群組不存在或無權限存取\n    at Function.updateTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:221:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:333:7)","timestamp":"2025-08-11 22:52:31:5231"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'更新交易群組錯誤: 已確認的交易無法修改'\u001b[39m","stack":"Error: 已確認的交易無法修改\n    at Function.updateTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:226:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:344:7)","timestamp":"2025-08-11 22:52:31:5231"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'更新交易群組錯誤: 交易群組編號 NEW001 已存在'\u001b[39m","stack":"Error: 交易群組編號 NEW001 已存在\n    at Function.updateTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:238:17)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:358:7)","timestamp":"2025-08-11 22:52:31:5231"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 交易群組不存在或無權限存取'\u001b[39m","stack":"Error: 交易群組不存在或無權限存取\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:286:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:402:7)","timestamp":"2025-08-11 22:52:31:5231"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 交易群組已經確認'\u001b[39m","stack":"Error: 交易群組已經確認\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:290:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:413:7)","timestamp":"2025-08-11 22:52:31:5231"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 已取消的交易無法確認'\u001b[39m","stack":"Error: 已取消的交易無法確認\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:294:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:424:7)","timestamp":"2025-08-11 22:52:31:5231"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 交易群組必須包含分錄才能確認'\u001b[39m","stack":"Error: 交易群組必須包含分錄才能確認\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:299:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:439:7)","timestamp":"2025-08-11 22:52:31:5231"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 交易借貸不平衡：借方 1000，貸方 500'\u001b[39m","stack":"Error: 交易借貸不平衡：借方 1000，貸方 500\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:307:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:457:7)","timestamp":"2025-08-11 22:52:31:5231"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'取消交易群組錯誤: 交易群組不存在或無權限存取'\u001b[39m","stack":"Error: 交易群組不存在或無權限存取\n    at Function.cancelTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:352:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:495:7)","timestamp":"2025-08-11 22:52:31:5231"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'取消交易群組錯誤: 交易群組已經取消'\u001b[39m","stack":"Error: 交易群組已經取消\n    at Function.cancelTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:356:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:506:7)","timestamp":"2025-08-11 22:52:31:5231"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'取消交易群組錯誤: 無法取消交易：有 2 筆交易引用此交易'\u001b[39m","stack":"Error: 無法取消交易：有 2 筆交易引用此交易\n    at Function.cancelTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:367:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:520:7)","timestamp":"2025-08-11 22:52:31:5231"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'計算交易餘額錯誤: 交易不存在、未確認或無權限存取'\u001b[39m","stack":"Error: 交易不存在、未確認或無權限存取\n    at Function.calculateTransactionBalance (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:501:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:570:7)","timestamp":"2025-08-11 22:52:31:5231"}
{"existingAccountIds":[],"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'缺少的科目 ID:'\u001b[39m","missingAccountIds":["nonexistent"],"queryConditions":{"uniqueAccountIds":["nonexistent"],"userId":"user123"},"timestamp":"2025-08-11 22:52:31:5231"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'創建自動會計分錄時發生錯誤: 部分會計科目不存在'\u001b[39m","stack":"Error: 部分會計科目不存在\n    at Function.getAccountDetails (D:\\pharmacy-pos\\backend\\services\\AutoAccountingEntryService.ts:210:13)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Function.handlePurchaseOrderCompletion (D:\\pharmacy-pos\\backend\\services\\AutoAccountingEntryService.ts:30:24)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\__tests__\\AutoAccountingEntryService.test.ts:241:7)","timestamp":"2025-08-11 22:52:50:5250"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'建立交易群組錯誤: 交易群組編號 TXN001 已存在'\u001b[39m","stack":"Error: 交易群組編號 TXN001 已存在\n    at Function.createTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:35:17)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:102:7)","timestamp":"2025-08-11 23:05:32:532"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'取得交易群組詳細資料錯誤: 交易群組不存在或無權限存取'\u001b[39m","stack":"Error: 交易群組不存在或無權限存取\n    at Function.getTransactionGroupById (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:162:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:235:7)","timestamp":"2025-08-11 23:05:32:532"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'更新交易群組錯誤: 交易群組不存在或無權限存取'\u001b[39m","stack":"Error: 交易群組不存在或無權限存取\n    at Function.updateTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:221:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:333:7)","timestamp":"2025-08-11 23:05:32:532"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'更新交易群組錯誤: 已確認的交易無法修改'\u001b[39m","stack":"Error: 已確認的交易無法修改\n    at Function.updateTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:226:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:344:7)","timestamp":"2025-08-11 23:05:32:532"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'更新交易群組錯誤: 交易群組編號 NEW001 已存在'\u001b[39m","stack":"Error: 交易群組編號 NEW001 已存在\n    at Function.updateTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:238:17)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:358:7)","timestamp":"2025-08-11 23:05:32:532"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 交易群組不存在或無權限存取'\u001b[39m","stack":"Error: 交易群組不存在或無權限存取\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:286:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:402:7)","timestamp":"2025-08-11 23:05:32:532"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 交易群組已經確認'\u001b[39m","stack":"Error: 交易群組已經確認\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:290:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:413:7)","timestamp":"2025-08-11 23:05:32:532"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 已取消的交易無法確認'\u001b[39m","stack":"Error: 已取消的交易無法確認\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:294:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:424:7)","timestamp":"2025-08-11 23:05:32:532"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 交易群組必須包含分錄才能確認'\u001b[39m","stack":"Error: 交易群組必須包含分錄才能確認\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:299:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:439:7)","timestamp":"2025-08-11 23:05:32:532"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 交易借貸不平衡：借方 1000，貸方 500'\u001b[39m","stack":"Error: 交易借貸不平衡：借方 1000，貸方 500\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:307:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:457:7)","timestamp":"2025-08-11 23:05:32:532"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'取消交易群組錯誤: 交易群組不存在或無權限存取'\u001b[39m","stack":"Error: 交易群組不存在或無權限存取\n    at Function.cancelTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:352:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:495:7)","timestamp":"2025-08-11 23:05:32:532"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'取消交易群組錯誤: 交易群組已經取消'\u001b[39m","stack":"Error: 交易群組已經取消\n    at Function.cancelTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:356:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:506:7)","timestamp":"2025-08-11 23:05:32:532"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'取消交易群組錯誤: 無法取消交易：有 2 筆交易引用此交易'\u001b[39m","stack":"Error: 無法取消交易：有 2 筆交易引用此交易\n    at Function.cancelTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:367:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:520:7)","timestamp":"2025-08-11 23:05:32:532"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'計算交易餘額錯誤: 交易不存在、未確認或無權限存取'\u001b[39m","stack":"Error: 交易不存在、未確認或無權限存取\n    at Function.calculateTransactionBalance (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:501:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:570:7)","timestamp":"2025-08-11 23:05:32:532"}
{"existingAccountIds":[],"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'缺少的科目 ID:'\u001b[39m","missingAccountIds":["nonexistent"],"queryConditions":{"uniqueAccountIds":["nonexistent"],"userId":"user123"},"timestamp":"2025-08-11 23:05:32:532"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31m創建銷售記錄錯誤: Database connection failed\u001b[39m","timestamp":"2025-08-11 23:05:44:544"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'創建自動會計分錄時發生錯誤: 部分會計科目不存在'\u001b[39m","stack":"Error: 部分會計科目不存在\n    at Function.getAccountDetails (D:\\pharmacy-pos\\backend\\services\\AutoAccountingEntryService.ts:210:13)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Function.handlePurchaseOrderCompletion (D:\\pharmacy-pos\\backend\\services\\AutoAccountingEntryService.ts:30:24)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\__tests__\\AutoAccountingEntryService.test.ts:241:7)","timestamp":"2025-08-11 23:06:26:626"}
{"error":"Database error","level":"\u001b[31merror\u001b[39m","message":"\u001b[31m建立交易錯誤\u001b[39m","timestamp":"2025-08-11 23:06:32:632"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'建立交易群組錯誤: 交易群組編號 TXN001 已存在'\u001b[39m","stack":"Error: 交易群組編號 TXN001 已存在\n    at Function.createTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:35:17)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:102:7)","timestamp":"2025-08-11 23:13:02:132"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'取得交易群組詳細資料錯誤: 交易群組不存在或無權限存取'\u001b[39m","stack":"Error: 交易群組不存在或無權限存取\n    at Function.getTransactionGroupById (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:162:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:235:7)","timestamp":"2025-08-11 23:13:02:132"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'更新交易群組錯誤: 交易群組不存在或無權限存取'\u001b[39m","stack":"Error: 交易群組不存在或無權限存取\n    at Function.updateTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:221:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:333:7)","timestamp":"2025-08-11 23:13:02:132"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'更新交易群組錯誤: 已確認的交易無法修改'\u001b[39m","stack":"Error: 已確認的交易無法修改\n    at Function.updateTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:226:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:344:7)","timestamp":"2025-08-11 23:13:02:132"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'更新交易群組錯誤: 交易群組編號 NEW001 已存在'\u001b[39m","stack":"Error: 交易群組編號 NEW001 已存在\n    at Function.updateTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:238:17)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:358:7)","timestamp":"2025-08-11 23:13:03:133"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 交易群組不存在或無權限存取'\u001b[39m","stack":"Error: 交易群組不存在或無權限存取\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:286:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:402:7)","timestamp":"2025-08-11 23:13:03:133"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 交易群組已經確認'\u001b[39m","stack":"Error: 交易群組已經確認\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:290:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:413:7)","timestamp":"2025-08-11 23:13:03:133"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 已取消的交易無法確認'\u001b[39m","stack":"Error: 已取消的交易無法確認\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:294:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:424:7)","timestamp":"2025-08-11 23:13:03:133"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 交易群組必須包含分錄才能確認'\u001b[39m","stack":"Error: 交易群組必須包含分錄才能確認\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:299:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:439:7)","timestamp":"2025-08-11 23:13:03:133"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 交易借貸不平衡：借方 1000，貸方 500'\u001b[39m","stack":"Error: 交易借貸不平衡：借方 1000，貸方 500\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:307:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:457:7)","timestamp":"2025-08-11 23:13:03:133"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'取消交易群組錯誤: 交易群組不存在或無權限存取'\u001b[39m","stack":"Error: 交易群組不存在或無權限存取\n    at Function.cancelTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:352:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:495:7)","timestamp":"2025-08-11 23:13:03:133"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'取消交易群組錯誤: 交易群組已經取消'\u001b[39m","stack":"Error: 交易群組已經取消\n    at Function.cancelTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:356:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:506:7)","timestamp":"2025-08-11 23:13:03:133"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'取消交易群組錯誤: 無法取消交易：有 2 筆交易引用此交易'\u001b[39m","stack":"Error: 無法取消交易：有 2 筆交易引用此交易\n    at Function.cancelTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:367:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:520:7)","timestamp":"2025-08-11 23:13:03:133"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'計算交易餘額錯誤: 交易不存在、未確認或無權限存取'\u001b[39m","stack":"Error: 交易不存在、未確認或無權限存取\n    at Function.calculateTransactionBalance (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:501:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:570:7)","timestamp":"2025-08-11 23:13:03:133"}
{"existingAccountIds":[],"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'缺少的科目 ID:'\u001b[39m","missingAccountIds":["nonexistent"],"queryConditions":{"uniqueAccountIds":["nonexistent"],"userId":"user123"},"timestamp":"2025-08-11 23:13:03:133"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31m創建銷售記錄錯誤: Database connection failed\u001b[39m","timestamp":"2025-08-11 23:13:18:1318"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'創建自動會計分錄時發生錯誤: 部分會計科目不存在'\u001b[39m","stack":"Error: 部分會計科目不存在\n    at Function.getAccountDetails (D:\\pharmacy-pos\\backend\\services\\AutoAccountingEntryService.ts:210:13)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Function.handlePurchaseOrderCompletion (D:\\pharmacy-pos\\backend\\services\\AutoAccountingEntryService.ts:30:24)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\__tests__\\AutoAccountingEntryService.test.ts:241:7)","timestamp":"2025-08-11 23:13:57:1357"}
{"error":"Database error","level":"\u001b[31merror\u001b[39m","message":"\u001b[31m建立交易錯誤\u001b[39m","timestamp":"2025-08-11 23:14:02:142"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'建立交易群組錯誤: 交易群組編號 TXN001 已存在'\u001b[39m","stack":"Error: 交易群組編號 TXN001 已存在\n    at Function.createTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:35:17)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:102:7)","timestamp":"2025-08-11 23:28:00:280"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'取得交易群組詳細資料錯誤: 交易群組不存在或無權限存取'\u001b[39m","stack":"Error: 交易群組不存在或無權限存取\n    at Function.getTransactionGroupById (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:162:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:235:7)","timestamp":"2025-08-11 23:28:00:280"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'更新交易群組錯誤: 交易群組不存在或無權限存取'\u001b[39m","stack":"Error: 交易群組不存在或無權限存取\n    at Function.updateTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:221:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:333:7)","timestamp":"2025-08-11 23:28:00:280"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'更新交易群組錯誤: 已確認的交易無法修改'\u001b[39m","stack":"Error: 已確認的交易無法修改\n    at Function.updateTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:226:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:344:7)","timestamp":"2025-08-11 23:28:00:280"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'更新交易群組錯誤: 交易群組編號 NEW001 已存在'\u001b[39m","stack":"Error: 交易群組編號 NEW001 已存在\n    at Function.updateTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:238:17)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:358:7)","timestamp":"2025-08-11 23:28:00:280"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 交易群組不存在或無權限存取'\u001b[39m","stack":"Error: 交易群組不存在或無權限存取\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:286:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:402:7)","timestamp":"2025-08-11 23:28:00:280"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 交易群組已經確認'\u001b[39m","stack":"Error: 交易群組已經確認\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:290:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:413:7)","timestamp":"2025-08-11 23:28:00:280"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 已取消的交易無法確認'\u001b[39m","stack":"Error: 已取消的交易無法確認\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:294:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:424:7)","timestamp":"2025-08-11 23:28:00:280"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 交易群組必須包含分錄才能確認'\u001b[39m","stack":"Error: 交易群組必須包含分錄才能確認\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:299:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:439:7)","timestamp":"2025-08-11 23:28:00:280"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 交易借貸不平衡：借方 1000，貸方 500'\u001b[39m","stack":"Error: 交易借貸不平衡：借方 1000，貸方 500\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:307:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:457:7)","timestamp":"2025-08-11 23:28:00:280"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'取消交易群組錯誤: 交易群組不存在或無權限存取'\u001b[39m","stack":"Error: 交易群組不存在或無權限存取\n    at Function.cancelTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:352:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:495:7)","timestamp":"2025-08-11 23:28:00:280"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'取消交易群組錯誤: 交易群組已經取消'\u001b[39m","stack":"Error: 交易群組已經取消\n    at Function.cancelTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:356:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:506:7)","timestamp":"2025-08-11 23:28:00:280"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'取消交易群組錯誤: 無法取消交易：有 2 筆交易引用此交易'\u001b[39m","stack":"Error: 無法取消交易：有 2 筆交易引用此交易\n    at Function.cancelTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:367:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:520:7)","timestamp":"2025-08-11 23:28:00:280"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'計算交易餘額錯誤: 交易不存在、未確認或無權限存取'\u001b[39m","stack":"Error: 交易不存在、未確認或無權限存取\n    at Function.calculateTransactionBalance (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:501:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:570:7)","timestamp":"2025-08-11 23:28:00:280"}
{"existingAccountIds":[],"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'缺少的科目 ID:'\u001b[39m","missingAccountIds":["nonexistent"],"queryConditions":{"uniqueAccountIds":["nonexistent"],"userId":"user123"},"timestamp":"2025-08-11 23:28:00:280"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31m創建銷售記錄錯誤: Database connection failed\u001b[39m","timestamp":"2025-08-11 23:28:16:2816"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'創建自動會計分錄時發生錯誤: 部分會計科目不存在'\u001b[39m","stack":"Error: 部分會計科目不存在\n    at Function.getAccountDetails (D:\\pharmacy-pos\\backend\\services\\AutoAccountingEntryService.ts:210:13)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Function.handlePurchaseOrderCompletion (D:\\pharmacy-pos\\backend\\services\\AutoAccountingEntryService.ts:30:24)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\__tests__\\AutoAccountingEntryService.test.ts:241:7)","timestamp":"2025-08-11 23:29:15:2915"}
{"error":"Database error","level":"\u001b[31merror\u001b[39m","message":"\u001b[31m建立交易錯誤\u001b[39m","timestamp":"2025-08-11 23:29:18:2918"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31m創建銷售記錄錯誤: Database connection failed\u001b[39m","timestamp":"2025-08-12 00:15:27:1527"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'建立交易群組錯誤: 交易群組編號 TXN001 已存在'\u001b[39m","stack":"Error: 交易群組編號 TXN001 已存在\n    at Function.createTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:35:17)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:102:7)","timestamp":"2025-08-12 00:15:59:1559"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'取得交易群組詳細資料錯誤: 交易群組不存在或無權限存取'\u001b[39m","stack":"Error: 交易群組不存在或無權限存取\n    at Function.getTransactionGroupById (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:162:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:235:7)","timestamp":"2025-08-12 00:15:59:1559"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'更新交易群組錯誤: 交易群組不存在或無權限存取'\u001b[39m","stack":"Error: 交易群組不存在或無權限存取\n    at Function.updateTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:221:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:333:7)","timestamp":"2025-08-12 00:15:59:1559"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'更新交易群組錯誤: 已確認的交易無法修改'\u001b[39m","stack":"Error: 已確認的交易無法修改\n    at Function.updateTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:226:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:344:7)","timestamp":"2025-08-12 00:15:59:1559"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'更新交易群組錯誤: 交易群組編號 NEW001 已存在'\u001b[39m","stack":"Error: 交易群組編號 NEW001 已存在\n    at Function.updateTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:238:17)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:358:7)","timestamp":"2025-08-12 00:15:59:1559"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 交易群組不存在或無權限存取'\u001b[39m","stack":"Error: 交易群組不存在或無權限存取\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:286:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:402:7)","timestamp":"2025-08-12 00:15:59:1559"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 交易群組已經確認'\u001b[39m","stack":"Error: 交易群組已經確認\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:290:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:413:7)","timestamp":"2025-08-12 00:15:59:1559"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 已取消的交易無法確認'\u001b[39m","stack":"Error: 已取消的交易無法確認\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:294:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:424:7)","timestamp":"2025-08-12 00:15:59:1559"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 交易群組必須包含分錄才能確認'\u001b[39m","stack":"Error: 交易群組必須包含分錄才能確認\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:299:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:439:7)","timestamp":"2025-08-12 00:15:59:1559"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 交易借貸不平衡：借方 1000，貸方 500'\u001b[39m","stack":"Error: 交易借貸不平衡：借方 1000，貸方 500\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:307:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:457:7)","timestamp":"2025-08-12 00:15:59:1559"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'取消交易群組錯誤: 交易群組不存在或無權限存取'\u001b[39m","stack":"Error: 交易群組不存在或無權限存取\n    at Function.cancelTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:352:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:495:7)","timestamp":"2025-08-12 00:15:59:1559"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'取消交易群組錯誤: 交易群組已經取消'\u001b[39m","stack":"Error: 交易群組已經取消\n    at Function.cancelTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:356:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:506:7)","timestamp":"2025-08-12 00:15:59:1559"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'取消交易群組錯誤: 無法取消交易：有 2 筆交易引用此交易'\u001b[39m","stack":"Error: 無法取消交易：有 2 筆交易引用此交易\n    at Function.cancelTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:367:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:520:7)","timestamp":"2025-08-12 00:15:59:1559"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'計算交易餘額錯誤: 交易不存在、未確認或無權限存取'\u001b[39m","stack":"Error: 交易不存在、未確認或無權限存取\n    at Function.calculateTransactionBalance (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:501:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:570:7)","timestamp":"2025-08-12 00:15:59:1559"}
{"existingAccountIds":[],"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'缺少的科目 ID:'\u001b[39m","missingAccountIds":["nonexistent"],"queryConditions":{"uniqueAccountIds":["nonexistent"],"userId":"user123"},"timestamp":"2025-08-12 00:15:59:1559"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'創建自動會計分錄時發生錯誤: 部分會計科目不存在'\u001b[39m","stack":"Error: 部分會計科目不存在\n    at Function.getAccountDetails (D:\\pharmacy-pos\\backend\\services\\AutoAccountingEntryService.ts:210:13)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Function.handlePurchaseOrderCompletion (D:\\pharmacy-pos\\backend\\services\\AutoAccountingEntryService.ts:30:24)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\__tests__\\AutoAccountingEntryService.test.ts:241:7)","timestamp":"2025-08-12 00:16:05:165"}
{"error":"Database error","level":"\u001b[31merror\u001b[39m","message":"\u001b[31m建立交易錯誤\u001b[39m","timestamp":"2025-08-12 00:16:13:1613"}
{"level":"\u001b[31merror\u001b[39m","message":"\u001b[31m創建銷售記錄錯誤: Database connection failed\u001b[39m","timestamp":"2025-08-12 00:21:50:2150"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'建立交易群組錯誤: 交易群組編號 TXN001 已存在'\u001b[39m","stack":"Error: 交易群組編號 TXN001 已存在\n    at Function.createTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:35:17)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:102:7)","timestamp":"2025-08-12 00:22:34:2234"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'取得交易群組詳細資料錯誤: 交易群組不存在或無權限存取'\u001b[39m","stack":"Error: 交易群組不存在或無權限存取\n    at Function.getTransactionGroupById (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:162:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:235:7)","timestamp":"2025-08-12 00:22:34:2234"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'更新交易群組錯誤: 交易群組不存在或無權限存取'\u001b[39m","stack":"Error: 交易群組不存在或無權限存取\n    at Function.updateTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:221:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:333:7)","timestamp":"2025-08-12 00:22:34:2234"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'更新交易群組錯誤: 已確認的交易無法修改'\u001b[39m","stack":"Error: 已確認的交易無法修改\n    at Function.updateTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:226:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:344:7)","timestamp":"2025-08-12 00:22:34:2234"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'更新交易群組錯誤: 交易群組編號 NEW001 已存在'\u001b[39m","stack":"Error: 交易群組編號 NEW001 已存在\n    at Function.updateTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:238:17)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:358:7)","timestamp":"2025-08-12 00:22:34:2234"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 交易群組不存在或無權限存取'\u001b[39m","stack":"Error: 交易群組不存在或無權限存取\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:286:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:402:7)","timestamp":"2025-08-12 00:22:34:2234"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 交易群組已經確認'\u001b[39m","stack":"Error: 交易群組已經確認\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:290:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:413:7)","timestamp":"2025-08-12 00:22:34:2234"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 已取消的交易無法確認'\u001b[39m","stack":"Error: 已取消的交易無法確認\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:294:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:424:7)","timestamp":"2025-08-12 00:22:34:2234"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 交易群組必須包含分錄才能確認'\u001b[39m","stack":"Error: 交易群組必須包含分錄才能確認\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:299:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:439:7)","timestamp":"2025-08-12 00:22:34:2234"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'確認交易群組錯誤: 交易借貸不平衡：借方 1000，貸方 500'\u001b[39m","stack":"Error: 交易借貸不平衡：借方 1000，貸方 500\n    at Function.confirmTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:307:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:457:7)","timestamp":"2025-08-12 00:22:34:2234"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'取消交易群組錯誤: 交易群組不存在或無權限存取'\u001b[39m","stack":"Error: 交易群組不存在或無權限存取\n    at Function.cancelTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:352:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:495:7)","timestamp":"2025-08-12 00:22:34:2234"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'取消交易群組錯誤: 交易群組已經取消'\u001b[39m","stack":"Error: 交易群組已經取消\n    at Function.cancelTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:356:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:506:7)","timestamp":"2025-08-12 00:22:34:2234"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'取消交易群組錯誤: 無法取消交易：有 2 筆交易引用此交易'\u001b[39m","stack":"Error: 無法取消交易：有 2 筆交易引用此交易\n    at Function.cancelTransactionGroup (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:367:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:520:7)","timestamp":"2025-08-12 00:22:34:2234"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'計算交易餘額錯誤: 交易不存在、未確認或無權限存取'\u001b[39m","stack":"Error: 交易不存在、未確認或無權限存取\n    at Function.calculateTransactionBalance (D:\\pharmacy-pos\\backend\\services\\accounting2\\TransactionService.ts:501:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\accounting2\\__tests__\\TransactionService.test.ts:570:7)","timestamp":"2025-08-12 00:22:34:2234"}
{"existingAccountIds":[],"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'缺少的科目 ID:'\u001b[39m","missingAccountIds":["nonexistent"],"queryConditions":{"uniqueAccountIds":["nonexistent"],"userId":"user123"},"timestamp":"2025-08-12 00:22:34:2234"}
{"level":"\u001b[31m'error'\u001b[39m","message":"\u001b[31m'創建自動會計分錄時發生錯誤: 部分會計科目不存在'\u001b[39m","stack":"Error: 部分會計科目不存在\n    at Function.getAccountDetails (D:\\pharmacy-pos\\backend\\services\\AutoAccountingEntryService.ts:210:13)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Function.handlePurchaseOrderCompletion (D:\\pharmacy-pos\\backend\\services\\AutoAccountingEntryService.ts:30:24)\n    at Object.<anonymous> (D:\\pharmacy-pos\\backend\\services\\__tests__\\AutoAccountingEntryService.test.ts:241:7)","timestamp":"2025-08-12 00:22:40:2240"}
{"error":"Database error","level":"\u001b[31merror\u001b[39m","message":"\u001b[31m建立交易錯誤\u001b[39m","timestamp":"2025-08-12 00:22:51:2251"}
